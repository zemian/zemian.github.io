<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Exploring different scheduling types with Quartz 2</title>
        <link rel="stylesheet" href="https://zemian.github.io/theme/css/main.css" />
        <link href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ZBlog Atom Feed" />
        <meta name="description" content="We often think of Cron when we want to schedule a job. Cron is very flexible in expressing an repeating occurance of an event/job in a very..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://zemian.github.io/">ZBlog</a></h1>
                <nav><ul>
                    <li><a href="https://zemian.github.io/pages/about-the-author.html">About The Author</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://zemian.github.io/2012/exploring-different-scheduling-types-with-quartz-2.html" rel="bookmark"
           title="Permalink to Exploring different scheduling types with Quartz 2">Exploring different scheduling types with Quartz 2</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-10-22T00:00:00-05:00">
                Published: Mon 22 October 2012
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://zemian.github.io/author/zemian-deng.html">Zemian Deng</a>
        </address>
<p>In <a href="https://zemian.github.io/category/blog.html">Blog</a>.</p>
<p>tags: <a href="https://zemian.github.io/tag/quartz.html">quartz</a> </p>
</footer><!-- /.post-info -->      <p>We often think of Cron when we want to schedule a job. Cron is very flexible in expressing an repeating occurance of an event/job in a very compact expression. However it's not answer for everything, as I often see people are asking for help in the Quartz user forum. Did you know that the popular <a href="http://quartz-scheduler.org">Quartz 2</a> library provide many other schedule types (called Trigger) besides cron? I will show you each of the Quartz 2 built-in schedule types here within a complete, standalone Groovy script that you can run and test it out. Let's start with a simple one.</p>
<div class="highlight"><pre><span></span><code>    <span class="nd">@Grab</span><span class="p">(</span><span class="s1">&#39;org.quartz-scheduler:quartz:2.1.6&#39;</span><span class="p">)</span>
    <span class="nd">@Grab</span><span class="p">(</span><span class="s1">&#39;org.slf4j:slf4j-simple:1.7.1&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">org.quartz.</span><span class="o">*</span>
    <span class="kn">import</span> <span class="nn">org.quartz.impl.</span><span class="o">*</span>
    <span class="kn">import</span> <span class="nn">org.quartz.jobs.</span><span class="o">*</span>

    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">DateBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">JobBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">TriggerBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">SimpleScheduleBuilder</span><span class="o">.*</span>

    <span class="k">def</span> <span class="nf">trigger</span> <span class="o">=</span> <span class="n">newTrigger</span><span class="p">()</span>
        <span class="o">.</span><span class="n">withSchedule</span><span class="p">(</span>
            <span class="n">simpleSchedule</span><span class="p">()</span>
            <span class="o">.</span><span class="n">withIntervalInSeconds</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="o">.</span><span class="n">repeatForever</span><span class="p">())</span>
        <span class="o">.</span><span class="n">startNow</span><span class="p">()</span>
        <span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">TriggerUtils</span><span class="o">.</span><span class="n">computeFireTimes</span><span class="p">(</span><span class="n">trigger</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">each</span><span class="p">{</span> <span class="n">println</span> <span class="n">it</span> <span class="p">}</span>
</code></pre></div>

<p>This is the Quartz's <code>SimpleTrigger</code>, and it allows you to create a fixed rate repeating job. You can even limit to certain number of count if you like. I have imported all the nessary classes the script needs, and I use the latest Quartz 2.x builder API to create an instance of the trigger.</p>
<p>The quickest way to explore and test out whether a scheduling fits your need is to print out its future execution times. Hence you see me using <code>TriggerUtils.computeFireTimes</code> in the script. Run the above and you should get the datetimes as scheduled to be run, in this case every 3 seconds.</p>
<div class="highlight"><pre><span></span><code>    bash&gt; $ groovy simpleTrigger.groovy
        Tue Oct 23 20:28:01 EDT 2012
        Tue Oct 23 20:28:04 EDT 2012
        Tue Oct 23 20:28:07 EDT 2012
        Tue Oct 23 20:28:10 EDT 2012
        Tue Oct 23 20:28:13 EDT 2012
        Tue Oct 23 20:28:16 EDT 2012
        Tue Oct 23 20:28:19 EDT 2012
        Tue Oct 23 20:28:22 EDT 2012
        Tue Oct 23 20:28:25 EDT 2012
        Tue Oct 23 20:28:28 EDT 2012
        Tue Oct 23 20:28:31 EDT 2012
        Tue Oct 23 20:28:34 EDT 2012
        Tue Oct 23 20:28:37 EDT 2012
        Tue Oct 23 20:28:40 EDT 2012
        Tue Oct 23 20:28:43 EDT 2012
        Tue Oct 23 20:28:46 EDT 2012
        Tue Oct 23 20:28:49 EDT 2012
        Tue Oct 23 20:28:52 EDT 2012
        Tue Oct 23 20:28:55 EDT 2012
        Tue Oct 23 20:28:58 EDT 2012
</code></pre></div>

<p>The most frequent used scheduling type is the <code>CronTrigger</code>, and you can test it out in similar way.</p>
<div class="highlight"><pre><span></span><code>    <span class="nd">@Grab</span><span class="p">(</span><span class="s1">&#39;org.quartz-scheduler:quartz:2.1.6&#39;</span><span class="p">)</span>
    <span class="nd">@Grab</span><span class="p">(</span><span class="s1">&#39;org.slf4j:slf4j-simple:1.7.1&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">org.quartz.</span><span class="o">*</span>
    <span class="kn">import</span> <span class="nn">org.quartz.impl.</span><span class="o">*</span>
    <span class="kn">import</span> <span class="nn">org.quartz.jobs.</span><span class="o">*</span>

    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">DateBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">JobBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">TriggerBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">CronScheduleBuilder</span><span class="o">.*</span>

    <span class="k">def</span> <span class="nf">trigger</span> <span class="o">=</span> <span class="n">newTrigger</span><span class="p">()</span>
        <span class="o">.</span><span class="n">withSchedule</span><span class="p">(</span><span class="n">cronSchedule</span><span class="p">(</span><span class="s2">&quot;0 30 08 * * ?&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">startNow</span><span class="p">()</span>
        <span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">TriggerUtils</span><span class="o">.</span><span class="n">computeFireTimes</span><span class="p">(</span><span class="n">trigger</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">each</span><span class="p">{</span> <span class="n">println</span> <span class="n">it</span> <span class="p">}</span>
</code></pre></div>

<p>The javadoc for <a href="http://quartz-scheduler.org/api/2.1.5/org/quartz/CronExpression.html">CronExpression</a> is very good and you should definately read it throughly to use it effectively. With the script, you can explore all the combination you want easily and verify future fire times before your job is invoked.</p>
<p>Now, if you have some odd scheduling needs such as run a job every 30 mins from MON to FRI and only between 8:00AM to 10:00AM, then don't try to cramp all that into the Cron expression. The Quartz 2.x has a dedicated trigger type just for this use, and it's 
called <code>DailyTimeIntervalTrigger</code>! Check this out:</p>
<div class="highlight"><pre><span></span><code>    <span class="nd">@Grab</span><span class="p">(</span><span class="s1">&#39;org.quartz-scheduler:quartz:2.1.6&#39;</span><span class="p">)</span>
    <span class="nd">@Grab</span><span class="p">(</span><span class="s1">&#39;org.slf4j:slf4j-simple:1.7.1&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">org.quartz.</span><span class="o">*</span>
    <span class="kn">import</span> <span class="nn">org.quartz.impl.</span><span class="o">*</span>
    <span class="kn">import</span> <span class="nn">org.quartz.jobs.</span><span class="o">*</span>

    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">DateBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">JobBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">TriggerBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">DailyTimeIntervalScheduleBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Calendar</span><span class="o">.*</span>

    <span class="k">def</span> <span class="nf">trigger</span> <span class="o">=</span> <span class="n">newTrigger</span><span class="p">()</span>
        <span class="o">.</span><span class="n">withSchedule</span><span class="p">(</span>
            <span class="n">dailyTimeIntervalSchedule</span><span class="p">()</span>
            <span class="o">.</span><span class="n">startingDailyAt</span><span class="p">(</span><span class="n">TimeOfDay</span><span class="o">.</span><span class="n">hourMinuteAndSecondOfDay</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="o">.</span><span class="n">endingDailyAt</span><span class="p">(</span><span class="n">TimeOfDay</span><span class="o">.</span><span class="n">hourMinuteAndSecondOfDay</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="o">.</span><span class="n">onDaysOfTheWeek</span><span class="p">(</span><span class="n">MONDAY</span><span class="p">,</span> <span class="n">TUESDAY</span><span class="p">,</span> <span class="n">WEDNESDAY</span><span class="p">,</span> <span class="n">THURSDAY</span><span class="p">,</span> <span class="n">FRIDAY</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withInterval</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">IntervalUnit</span><span class="o">.</span><span class="n">MINUTE</span><span class="p">))</span>
        <span class="o">.</span><span class="n">startNow</span><span class="p">()</span>
        <span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">TriggerUtils</span><span class="o">.</span><span class="n">computeFireTimes</span><span class="p">(</span><span class="n">trigger</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">each</span><span class="p">{</span> <span class="n">println</span> <span class="n">it</span> <span class="p">}</span>
</code></pre></div>

<p>Another hidden Trigger type from Quartz is <code>CalendarIntervalTrigger</code>, and you would use this if you need to repeat job that's in every interval of a calendar period, such as every year or month etc, where the interval is not fixed, but calendar specific. Here is a test script for that.</p>
<div class="highlight"><pre><span></span><code>    <span class="nd">@Grab</span><span class="p">(</span><span class="s1">&#39;org.quartz-scheduler:quartz:2.1.6&#39;</span><span class="p">)</span>
    <span class="nd">@Grab</span><span class="p">(</span><span class="s1">&#39;org.slf4j:slf4j-simple:1.7.1&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">org.quartz.</span><span class="o">*</span>
    <span class="kn">import</span> <span class="nn">org.quartz.impl.</span><span class="o">*</span>
    <span class="kn">import</span> <span class="nn">org.quartz.jobs.</span><span class="o">*</span>

    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">DateBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">JobBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">TriggerBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">quartz</span><span class="o">.</span><span class="n">CalendarIntervalScheduleBuilder</span><span class="o">.*</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Calendar</span><span class="o">.*</span>

    <span class="k">def</span> <span class="nf">trigger</span> <span class="o">=</span> <span class="n">newTrigger</span><span class="p">()</span>
        <span class="o">.</span><span class="n">withSchedule</span><span class="p">(</span>
            <span class="n">calendarIntervalSchedule</span><span class="p">()</span>
            <span class="o">.</span><span class="n">withInterval</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">IntervalUnit</span><span class="o">.</span><span class="n">MONTH</span><span class="p">))</span>
        <span class="o">.</span><span class="n">startAt</span><span class="p">(</span><span class="n">futureDate</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">IntervalUnit</span><span class="o">.</span><span class="n">MINUTE</span><span class="p">))</span>
        <span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">TriggerUtils</span><span class="o">.</span><span class="n">computeFireTimes</span><span class="p">(</span><span class="n">trigger</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">each</span><span class="p">{</span> <span class="n">println</span> <span class="n">it</span> <span class="p">}</span>
</code></pre></div>

<p>I hope these will help you get started on most of your scheduling need with Quartz 2. Try these out and see your future fire times before even scheduling a job into the scheduler should save you some times and troubles.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>