<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>A better java shell script wrapper</title>
        <link rel="stylesheet" href="https://zemian.github.io/theme/css/main.css" />
        <link href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ZBlog Atom Feed" />
        <meta name="description" content="In many Java projects, you often see wrapper shell script to invoke the java command with its custom application parameters. For example,..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://zemian.github.io/">ZBlog</a></h1>
                <nav><ul>
                    <li><a href="https://zemian.github.io/pages/about-the-author.html">About The Author</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://zemian.github.io/2012/a-better-java-shell-script-wrapper.html" rel="bookmark"
           title="Permalink to A better java shell script wrapper">A better java shell script wrapper</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-08-01T00:00:00-05:00">
                Published: Wed 01 August 2012
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://zemian.github.io/author/zemian-deng.html">Zemian Deng</a>
        </address>
<p>In <a href="https://zemian.github.io/category/blog.html">Blog</a>.</p>
<p>tags: <a href="https://zemian.github.io/tag/java.html">java</a> <a href="https://zemian.github.io/tag/bash.html">bash</a> <a href="https://zemian.github.io/tag/shell.html">shell</a> </p>
</footer><!-- /.post-info -->      <p>In many Java projects, you often see wrapper shell script to invoke the <code>java</code> command with its custom application parameters. For example, <code>$ANT_HOME/bin/ant</code>, <code>$GROOVY_HOME/bin/groovy</code>, or even in our <a href="http://bitbucket.org/timemachine/scheduler">TimeMachine Scheduler</a> you will see <code>$TIMEMACHINE_HOME/bin/scheduler.sh</code>.</p>
<p>Writing these wrapper script is boring and error prone. Most of the problems come from setting the correct classpath for the application. If you're working on an in-house project for a company, then you can get away with hardcoding paths and your environment vars. But for open source projects, folks have to make the wrapper more flexible and generic. Most of them even provide a <code>.bat</code> version of it. Windows DOS is really a brutal and limited terminal to script away your project need. For this reason, I often encourage others to use Cygwin as much as they can. It at least has a real bash shell to work with. Another common problem with these wrappers is it can quickly get out of hand and have too many duplication of similar scripts liter every where in your project.</p>
<p>In this post, I will show you a Java wrapper script that I've written. It's simple to use and very flexible for running just about any Java program. Let's see how it's used first, and then I will print its content at the bottom of the post.</p>
<h2>Introducing the <code>run-java</code> wrapper script</h2>
<p>If you take a look at <code>$TIMEMACHINE_HOME/bin/scheduler.sh</code>, you will see that it in turns calls a <code>run-java</code> script that comes in the same directory.</p>
<div class="highlight"><pre><span></span><code><span class="kt">DIR</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">dirname</span><span class="w"> </span><span class="n">$0</span><span class="p">)</span><span class="w"></span>
<span class="n">SCHEDULER_HOME</span><span class="o">=</span><span class="n">$DIR</span><span class="o">/</span><span class="p">..</span><span class="w"></span>
<span class="n">$DIR</span><span class="o">/</span><span class="n">run</span><span class="o">-</span><span class="n">java</span><span class="w"> </span><span class="o">-</span><span class="n">Dscheduler</span><span class="p">.</span><span class="n">home</span><span class="o">=</span><span class="s">&quot;$SCHEDULER_HOME&quot;</span><span class="w"> </span><span class="n">timemachine</span><span class="p">.</span><span class="n">scheduler</span><span class="p">.</span><span class="n">tool</span><span class="p">.</span><span class="n">SchedulerServer</span><span class="w"> </span><span class="s">&quot;$@&quot;</span><span class="w"></span>
</code></pre></div>

<p>As you can see, our <code>run-java</code> can take <code>-D</code> options. Not only this, it can also take <code>-cp</code> option as well! What's more is that you can specify these options even <strong>after</strong> the main class! This makes the <code>run-java</code> re-wrappable by other script, and still be able to add additional system properties and classpath.</p>
<p>For examples, the TimeMachine comes with Groovy library, so instead of downloading it's full distribution again, you can simply invoke the groovy like this</p>
<div class="highlight"><pre><span></span><code>$TIMEMACHINE_HOME/bin/run-java groovy.ui.GroovyMain test.groovy
</code></pre></div>

<p>You can use <code>run-java</code> in any directory you're in, so it's convenient. It will resolve it's own directory and load any jars in the <code>lib</code> directory automatically. Now if you want Groovy to run with more additional jars, you can use the <code>-cp</code> option like this:</p>
<div class="highlight"><pre><span></span><code>$TIMEMACHINE_HOME/bin/run-java -cp &quot;$HOME/apps/my-app/lib/*&quot; groovy.ui.GroovyMain test.groovy
</code></pre></div>

<p>Often times things will go wrong if you are not careful with Java classpath, but with <code>run-java</code> script you can perform a dry run first:</p>
<div class="highlight"><pre><span></span><code>RUN_JAVA_DRY=1 $TIMEMACHINE_HOME/bin/run-java -cp &quot;$HOME/apps/my-app/lib/*&quot; groovy.ui.GroovyMain test.groovy
</code></pre></div>

<p>You would run the above all in single line on a command prompt. It should print out your full java command with all options and arguments for you to inspect.</p>
<p>There are many more options to the script, which you can find out more by reading the comments in it. The current script will work on any Linux bash or on a Windows Cygwin terminal.</p>
<h2>Using <code>run-java</code> during development with Maven</h2>
<p>Above examples are assuming you are in a released project structure such as this:</p>
<div class="highlight"><pre><span></span><code>    $TIMEMACHINE_HOME
      +- bin/run-java
      +- lib/*.jar
</code></pre></div>

<p>But what about during development? A frequent use case is that you want to be able to run your latest compiled classes under <code>target/classes</code> without have to package up or release the entire project. You can use our <code>run-java</code> in these scenario as well. First, simply add <code>bin/run-java</code> in your project, then you run <code>mvn compile dependency:copy-dependencies</code> that will generate all the <code>jar</code> files into <code>target/dependency</code>. That's all. The <code>run-java</code> will automatically detect these directories and create the correct classpath to run your main class.</p>
<p>If you use Eclipse IDE for development, then your <code>target/classes</code> will be always up-to-date, and the <code>run-java</code> can be a great gem to have in your project even for development.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>