<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Exploring Spring Controller with JSTL view</title>
        <link rel="stylesheet" href="https://zemian.github.io/theme/css/main.css" />
        <link href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ZBlog Atom Feed" />
        <meta name="description" content="Let’s improve our previous Spring JDBC application with some more exploration on Spring MVC’s Controller development. I will show another exercise..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://zemian.github.io/">ZBlog</a></h1>
                <nav><ul>
                    <li><a href="https://zemian.github.io/pages/about-the-author.html">About The Author</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://zemian.github.io/2013/exploring-spring-controller-with-jstl-view.html" rel="bookmark"
           title="Permalink to Exploring Spring Controller with JSTL view">Exploring Spring Controller with JSTL view</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-10-16T00:00:00-05:00">
                Published: Wed 16 October 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://zemian.github.io/author/zemian-deng.html">Zemian Deng</a>
        </address>
<p>In <a href="https://zemian.github.io/category/blog.html">Blog</a>.</p>
<p>tags: <a href="https://zemian.github.io/tag/spring.html">spring</a> </p>
</footer><!-- /.post-info -->      <p>Let&#8217;s improve <a href="https://zemian.github.io/2013/10/getting-started-with-spring-jdbc-in-web.html">our previous Spring JDBC application</a> with some more exploration on Spring MVC&#8217;s Controller development. I will show another exercise of writing a new Controller that processes a HTML form and use JSTL tags in JSP view pages.</p>
<p>To enable JSTL in Spring MVC application, you would need to add the following to the <code>WebAppConfig</code> config class. Let&#8217;s move it outside of <code>WebApp.java</code> and into it&#8217;s own top level class file in <code>src/main/java/springweb/WebAppConfig.java</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">springweb</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.view.InternalResourceViewResolver</span><span class="p">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableWebMvc</span>
<span class="nd">@ComponentScan</span><span class="p">(</span><span class="s2">&quot;springweb.controller&quot;</span><span class="p">)</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">WebAppConfig</span> <span class="p">{</span>
    <span class="nd">@Bean</span>
    <span class="n">public</span> <span class="n">InternalResourceViewResolver</span> <span class="n">viewResolver</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">InternalResourceViewResolver</span> <span class="n">result</span> <span class="o">=</span> <span class="n">new</span> <span class="n">InternalResourceViewResolver</span><span class="p">();</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setPrefix</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">);</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setSuffix</span><span class="p">(</span><span class="s2">&quot;.jsp&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Inside the <code>InternalResourceViewResolver</code> bean, you define where to find your JSP pages that may have JSTL tags in them. The <code>prefix</code> setter is a path in relative to your <code>src/webapp</code> location. This allow you to hide your JSP files completely if you want to. For example, by setting it to <code>"/WEB-INF/jsp"</code> then you may move and store all JSP files into <code>src/webapp/WEB-INF/jsp</code> which is private in the web application. The <code>suffix</code> is just the file extension. These two values allow you to return a view name inside the controller with just the basename of your JSP file, which can be short as "/myform" or "/index" etc.</p>
<p>If you are to use Tomcat as your web container, you would need to add JSTL jar dependency as well, since the Tomcat server doesn&#8217;t come with standard tag library! So add this into the <code>pom.xml</code> file now.</p>
<div class="highlight"><pre><span></span><code>        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jstl<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>

<p>While you&#8217;re at the <code>pom.xml</code> file, you might want to add the Tomcat maven plugin so you can type less in command line when running your web application.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;project&gt;</span>
...
    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.tomcat.maven<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>tomcat7-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
...
<span class="nt">&lt;/project&gt;</span>
</code></pre></div>

<p>With that, you should able to run <code>mvn tomcat7:run</code> in root of your project without plugin prefix.</p>
<p>So what does JSTL bring to your application? Well, quite a bit actually. It lets you use some standard JSP tags that&#8217;s frequently used when writing JSP views. I will demonstrate this with a set of Controller and views to capture user comments from the application. Note that I will try to show you how to work with Spring Controller in the most basic way only. The Spring actually comes with a custom <code>form</code> JSP tag that is much more powerful to use. I will reserve that as another article in another time. Today let us focus on learning more about basic Spring Controller and JSTL, and a bit more on Spring JDBC data service as well.</p>
<p>We want to capture user comment, so let&#8217;s add a database table to store that information. Add the following DDL into your <code>src/main/resources/schema.sql</code> file. Again, this is for H2 database per last article project setup.</p>
<div class="highlight"><pre><span></span><code>CREATE TABLE COMMENT (
  ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  TEXT VARCHAR(10240) NOT NULL,
  FROM_USER VARCHAR(15) NULL,
  FROM_USER_IP VARCHAR(15) NULL,
  FROM_URL VARCHAR(1024) NULL,
  TAG VARCHAR(1024) NULL,
  TS DATETIME NOT NULL
);
</code></pre></div>

<p>This time, we will write a data model class to match this table. Let&#8217;s add <code>src/main/java/springweb/data/Comment.java</code></p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">springweb</span><span class="o">.</span><span class="n">data</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">Comment</span> <span class="p">{</span>
    <span class="n">Long</span> <span class="nb">id</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">text</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">fromUrl</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">fromUser</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">fromUserIp</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">tag</span><span class="p">;</span>
    <span class="n">Date</span> <span class="n">ts</span><span class="p">;</span>

    <span class="n">public</span> <span class="n">Long</span> <span class="n">getId</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setId</span><span class="p">(</span><span class="n">Long</span> <span class="nb">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">String</span> <span class="n">getText</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setText</span><span class="p">(</span><span class="n">String</span> <span class="n">text</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">String</span> <span class="n">getFromUrl</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fromUrl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setFromUrl</span><span class="p">(</span><span class="n">String</span> <span class="n">fromUrl</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">fromUrl</span> <span class="o">=</span> <span class="n">fromUrl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">String</span> <span class="n">getFromUser</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fromUser</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setFromUser</span><span class="p">(</span><span class="n">String</span> <span class="n">fromUser</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">fromUser</span> <span class="o">=</span> <span class="n">fromUser</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">String</span> <span class="n">getFromUserIp</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fromUserIp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setFromUserIp</span><span class="p">(</span><span class="n">String</span> <span class="n">fromUserIp</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">fromUserIp</span> <span class="o">=</span> <span class="n">fromUserIp</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">String</span> <span class="n">getTag</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">tag</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setTag</span><span class="p">(</span><span class="n">String</span> <span class="n">tag</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">Date</span> <span class="n">getTs</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ts</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setTs</span><span class="p">(</span><span class="n">Date</span> <span class="n">ts</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">private</span> <span class="n">String</span> <span class="n">getTrimedComment</span><span class="p">(</span><span class="nb">int</span> <span class="n">maxLen</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">text</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">null</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">maxLen</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">text</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxLen</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;Comment{&quot;</span> <span class="o">+</span>
                <span class="s2">&quot;id=&quot;</span> <span class="o">+</span> <span class="nb">id</span> <span class="o">+</span>
                <span class="s2">&quot;, ts=&quot;</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">+</span>
                <span class="s2">&quot;, text=&#39;&quot;</span> <span class="o">+</span> <span class="n">getTrimedComment</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;}&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">Comment</span> <span class="n">create</span><span class="p">(</span><span class="n">String</span> <span class="n">commentText</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Comment</span> <span class="n">result</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Comment</span><span class="p">();</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">commentText</span><span class="p">);</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setTs</span><span class="p">(</span><span class="n">new</span> <span class="n">Date</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Just as previous artcicle, we will write a data service to handle insert and retrieve of the data model. We add a new <code>src/main/java/springweb/data/CommentService.java</code> file</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">springweb</span><span class="o">.</span><span class="n">data</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.logging.Log</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.LogFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.BeanPropertyRowMapper</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.JdbcTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.RowMapper</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.simple.SimpleJdbcInsert</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="p">;</span>

<span class="nd">@Repository</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">CommentService</span> <span class="p">{</span>
    <span class="n">public</span> <span class="n">static</span> <span class="n">Log</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">LogFactory</span><span class="o">.</span><span class="n">getLog</span><span class="p">(</span><span class="n">CommentService</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>

    <span class="n">private</span> <span class="n">JdbcTemplate</span> <span class="n">jdbcTemplate</span><span class="p">;</span>
    <span class="n">private</span> <span class="n">SimpleJdbcInsert</span> <span class="n">insertActor</span><span class="p">;</span>
    <span class="n">private</span> <span class="n">RowMapper</span><span class="o">&lt;</span><span class="n">Comment</span><span class="o">&gt;</span> <span class="n">commentBeanRowMapper</span> <span class="o">=</span> <span class="n">new</span> <span class="n">BeanPropertyRowMapper</span><span class="o">&lt;</span><span class="n">Comment</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Comment</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>

    <span class="nd">@Autowired</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">setDataSource</span><span class="p">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">jdbcTemplate</span> <span class="o">=</span> <span class="n">new</span> <span class="n">JdbcTemplate</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>
        <span class="n">this</span><span class="o">.</span><span class="n">insertActor</span> <span class="o">=</span> <span class="n">new</span> <span class="n">SimpleJdbcInsert</span><span class="p">(</span><span class="n">dataSource</span><span class="p">)</span>
            <span class="o">.</span><span class="n">withTableName</span><span class="p">(</span><span class="s2">&quot;COMMENT&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">usingGeneratedKeyColumns</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">insert</span><span class="p">(</span><span class="n">Comment</span> <span class="n">comment</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Inserting Comment + &quot;</span> <span class="o">+</span> <span class="n">comment</span><span class="p">);</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;TEXT&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">.</span><span class="n">getText</span><span class="p">());</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;FROM_USER&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">.</span><span class="n">getFromUser</span><span class="p">());</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;FROM_USER_IP&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">.</span><span class="n">getFromUserIp</span><span class="p">());</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;FROM_URL&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">.</span><span class="n">getFromUrl</span><span class="p">());</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;TAG&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">.</span><span class="n">getTag</span><span class="p">());</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;TS&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">.</span><span class="n">getTs</span><span class="p">());</span>
        <span class="n">Number</span> <span class="n">newId</span> <span class="o">=</span> <span class="n">insertActor</span><span class="o">.</span><span class="n">executeAndReturnKey</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span>
        <span class="n">comment</span><span class="o">.</span><span class="n">setId</span><span class="p">(</span><span class="n">newId</span><span class="o">.</span><span class="n">longValue</span><span class="p">());</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;New Comment inserted. Id=&quot;</span> <span class="o">+</span> <span class="n">comment</span><span class="o">.</span><span class="n">getId</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Comment</span><span class="o">&gt;</span> <span class="n">findComments</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;ID as id, &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;TEXT as text, &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;TAG as tag, &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;TS as ts, &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;FROM_USER as fromUser, &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;FROM_USER_IP as fromUserIp, &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;FROM_URL as fromUrl &quot;</span> <span class="o">+</span>
                <span class="s2">&quot;FROM COMMENT ORDER BY TS&quot;</span><span class="p">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Comment</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">jdbcTemplate</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">commentBeanRowMapper</span><span class="p">);</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; Comment records.&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Since we did not use any fancy ORM but just plain JDBC, we will have to write SQL in the data service. But thanks to Spring goodies, it makes life much easier with helpers such as <code>SimpleJdbcInsert</code>, which handles DB insert and retrieval of auto generated key etc. And also notice that in query, we use the Spring&#8217;s <code>BeanPropertyRowMapper</code> to automatically convert JDBC resultset into a java bean <code>Comment</code> object! Simple, direct and quick.</p>
<p>Now we add the Spring controller in <code>src/main/java/springweb/controller/CommentController.java</code> to handle web requests.</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">springweb</span><span class="o">.</span><span class="n">controller</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">springweb.data.Comment</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">springweb.data.CommentService</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">CommentController</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">private</span> <span class="n">CommentService</span> <span class="n">commentService</span><span class="p">;</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;/comments&quot;</span><span class="p">)</span>
    <span class="n">public</span> <span class="n">ModelAndView</span> <span class="n">comments</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Comment</span><span class="o">&gt;</span> <span class="n">comments</span> <span class="o">=</span> <span class="n">commentService</span><span class="o">.</span><span class="n">findComments</span><span class="p">();</span>
        <span class="n">ModelAndView</span> <span class="n">result</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ModelAndView</span><span class="p">(</span><span class="s2">&quot;/comments&quot;</span><span class="p">);</span>
        <span class="n">result</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="s2">&quot;comments&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;/comment&quot;</span><span class="p">)</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">comment</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;comment&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;/comment&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
    <span class="n">public</span> <span class="n">ModelAndView</span> <span class="n">postComment</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="p">,</span> <span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">commentText</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">fromUrl</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">getRequestURI</span><span class="p">();</span>
        <span class="n">String</span> <span class="n">user</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">getRemoteUser</span><span class="p">();</span>
        <span class="n">String</span> <span class="n">userIp</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">getRemoteAddr</span><span class="p">();</span>
        <span class="n">Comment</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">Comment</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">commentText</span><span class="p">);</span>
        <span class="n">comment</span><span class="o">.</span><span class="n">setFromUserIp</span><span class="p">(</span><span class="n">userIp</span><span class="p">);</span>
        <span class="n">comment</span><span class="o">.</span><span class="n">setFromUser</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
        <span class="n">comment</span><span class="o">.</span><span class="n">setFromUrl</span><span class="p">(</span><span class="n">fromUrl</span><span class="p">);</span>
        <span class="n">commentService</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">comment</span><span class="p">);</span>
        <span class="n">ModelAndView</span> <span class="n">result</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ModelAndView</span><span class="p">(</span><span class="s2">&quot;comment-posted&quot;</span><span class="p">);</span>
        <span class="n">result</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>In this controller we map <code>/comment</code> URL to handle display of the HTML form, which returns the <code>comment.jsp</code> view. The method default to handle a HTTP <code>GET</code>. Note that we remapped same <code>/comment</code> URL to handle HTTP <code>POST</code> on a separated <code>postComment()</code> method! See how clean the Spring Controller can be in this demo to handle HTTP request. Pay very close attention to the parameters declared in the <code>postComment()</code> method. Spring automatically handles the HTTP request object and map to your method just based upon the types you declared! On some cases you need to be explicit with the help of annotation such as <code>@RequestParam</code>, but Spring does the parsing of HTTP request and extraction for you! This saves you tons of repeated boiler plate code if we were to write a direct Servlet code.</p>
<p>Now let&#8217;s see the view and how to use JSTL. The <code>/comments</code> URL is mapped to <code>src/main/webapp/comments.jsp</code> view file, which will list all <code>Comment</code> model objects.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;%</span><span class="err">@</span> <span class="n">taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;c&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s2">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;c:choose&gt;</span>
<span class="nt">&lt;c:when</span> <span class="na">test=</span><span class="s">&quot;${empty comments}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>There are no comments in system yet.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/c:when&gt;</span>
<span class="nt">&lt;c:otherwise&gt;</span>
    <span class="nt">&lt;table</span> <span class="na">border=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td&gt;</span>INDEX<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>TIME<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>FROM<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>COMMENT<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;c:forEach</span> <span class="na">items=</span><span class="s">&quot;${comments}&quot;</span> <span class="na">var=</span><span class="s">&quot;comment&quot;</span> <span class="na">varStatus=</span><span class="s">&quot;status&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tr</span> <span class="na">valign=</span><span class="s">&quot;top&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;td&gt;</span>${status.index}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>${comment.ts}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>${comment.fromUserIp}<span class="nt">&lt;/td&gt;</span>
        <span class="cp">&lt;%-</span><span class="o">-</span> <span class="no">The</span> <span class="ss">c</span><span class="p">:</span><span class="n">out</span> <span class="n">will</span> <span class="n">escape</span> <span class="n">html</span><span class="o">/</span><span class="n">xml</span> <span class="n">characters</span><span class="o">.</span> <span class="o">-</span><span class="cp">-%&gt;</span>
        <span class="nt">&lt;td&gt;&lt;pre&gt;&lt;c:out</span> <span class="na">value=</span><span class="s">&quot;${comment.text}&quot;</span><span class="nt">/&gt;&lt;/pre&gt;&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/c:forEach&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/c:otherwise&gt;</span>
<span class="nt">&lt;/c:choose&gt;</span>
</code></pre></div>

<p>Pretty standard stuff on JSTL. Next is the HTML form to post comment in <code>src/main/webapp/comment.jsp</code> file.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;comment&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">&quot;commentText&quot;</span> <span class="na">rows=</span><span class="s">&quot;20&quot;</span> <span class="na">cols=</span><span class="s">&quot;80&quot;</span><span class="nt">&gt;&lt;/textarea&gt;</span>
<span class="nt">&lt;br/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Post&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div>

<p>When form is posted and processed successful, we simply return to a new page in <code>src/main/webapp/comment-posted.jsp</code> file as output.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;p&gt;</span>Your comment has been posted. Comment ID=<span class="cp">${</span><span class="n">comment</span><span class="o">.</span><span class="n">id</span><span class="cp">}</span><span class="nt">&lt;/p&gt;</span>
</code></pre></div>

<p>If you've done these right, you should able to run <code>mvn tomcat7:run</code> and browse <code>http://localhost:8080/spring-web-annotation/comment</code> to see the form. Go to <code>/comments</code> URL to verify all the comments posted.</p>
<p>Note that despite I used Spring Controller as backend, all the views are in basic JSTL, and even the form are just basic HTML elements! I did this so you can see how flexible Spring Controller can be.</p>
<p>I know these are lot of code to post as a blog article today, but I wanted to be complete and try to show a  working demo with tutorial notes. I choose to make it into a single post with file content instead of having you download a project somewhere else. It makes my notes and explanation easier to match onto the code.</p>
<p>And that will conclude our tutorial for today. Please leave a note if you find this helpful.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>