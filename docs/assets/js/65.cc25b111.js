(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{448:function(e,a,t){"use strict";t.r(a);var n=t(10),o=Object(n.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("This is a long article that contains three separate topics:")]),e._v(" "),t("ul",[t("li",[e._v("Getting started with Apache Camel with Java")]),e._v(" "),t("li",[e._v("Improving startup of routes with a CamelRunner")]),e._v(" "),t("li",[e._v("Building message based application using Camel")])]),e._v(" "),t("p",[e._v("But since I've prepared a "),t("a",{attrs:{href:"https://bitbucket.org/saltnlight5/sandbox/downloads",target:"_blank",rel:"noopener noreferrer"}},[e._v("camel-demo-1.0.0-SNAPSHOT-project.zip"),t("OutboundLink")],1),e._v(" that has all these materials included, I thought it would easier to combine them and present it as whole.")]),e._v(" "),t("h1",{attrs:{id:"getting-started-with-apache-camel-with-java"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#getting-started-with-apache-camel-with-java"}},[e._v("#")]),e._v(" Getting started with Apache Camel with Java")]),e._v(" "),t("p",[e._v("Trying out "),t("a",{attrs:{href:"http://saltnlight5.blogspot.com/2012/08/getting-started-with-apache-camel-using.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Camel with few Groovy lines"),t("OutboundLink")],1),e._v(" is one thing, but\ngetting a full scale project in Java is another matter. Today, I will show you how to get things started on "),t("a",{attrs:{href:"http://camel.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Apache Camel"),t("OutboundLink")],1),e._v(" with\n"),t("a",{attrs:{href:"http://maven.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Maven"),t("OutboundLink")],1),e._v(" based project. You may also use the provided "),t("code",[e._v("camel-demo")]),e._v(" as project template to jump start your own Apache Camel\nproject. You would just need to rename the Java package and rename the pom's group and artifact id's to match your need.")]),e._v(" "),t("h2",{attrs:{id:"preparing-a-maven-based-project-with-camel-dependencies"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#preparing-a-maven-based-project-with-camel-dependencies"}},[e._v("#")]),e._v(" Preparing a Maven based project with Camel dependencies")]),e._v(" "),t("p",[e._v("Unzip the "),t("code",[e._v("camel-demo")]),e._v(" project source, and you will see the basic directory layout.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("    camel-demo\n        +- bin\n        +- config\n        +- data\n        +- src\n        +- pom.xml\n        +- README.txt\n")])])]),t("p",[e._v("What makes this demo a Camel based project is just the declaration in "),t("code",[e._v("pom.xml")]),e._v(". Let's take a look the file and its dependencies.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('    <?xml version="1.0" encoding="UTF-8"?>\n    <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n        xsi:schemaLocation="http://maven.apache.org/POM/4.0.0   http://maven.apache.org/maven-v4_0_0.xsd">\n    \n        <modelVersion>4.0.0</modelVersion>\n        <groupId>deng.cameldemo</groupId>\n        <artifactId>camel-demo</artifactId>\n        <version>1.0.0-SNAPSHOT</version>\n        <packaging>jar</packaging>\n    \n        <properties>\n            <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n            <slf4j.version>1.6.6</slf4j.version>\n            <camel.version>2.10.1</camel.version>\n        </properties>\n    \n        <build>\n            <plugins>\n                <plugin>\n                    <artifactId>maven-compiler-plugin</artifactId>\n                    <version>2.3.2</version>\n                    <configuration>\n                        <source>1.6</source>\n                        <target>1.6</target>\n                    </configuration>\n                </plugin>\n                <plugin>\n                    <artifactId>maven-assembly-plugin</artifactId>\n                    <version>2.3</version>\n                    <configuration>\n                        <descriptorRefs>\n                            <descriptorRef>project</descriptorRef>\n                            <descriptorRef>jar-with-dependencies</descriptorRef>\n                        </descriptorRefs>\n                    </configuration>\n                    <executions>\n                        <execution>\n                            <id>make-assembly</id>\n                            <phase>package</phase>\n                            <goals>\n                                <goal>single</goal>\n                            </goals>\n                        </execution>\n                    </executions>\n                </plugin>\n            </plugins>\n        </build>\n    \n        <dependencies>\n    \n            \x3c!-- Unit testing lib --\x3e\n            <dependency>\n                <groupId>junit</groupId>\n                <artifactId>junit-dep</artifactId>\n                <version>4.10</version>\n                <scope>test</scope>\n            </dependency>\n            <dependency>\n                <groupId>org.hamcrest</groupId>\n                <artifactId>hamcrest-library</artifactId>\n                <version>1.2.1</version>\n                <scope>test</scope>\n            </dependency>\n    \n            \x3c!-- Logging lib --\x3e\n            <dependency>\n                <groupId>org.slf4j</groupId>\n                <artifactId>slf4j-api</artifactId>\n                <version>${slf4j.version}</version>\n            </dependency>\n            <dependency>\n                <groupId>org.slf4j</groupId>\n                <artifactId>slf4j-log4j12</artifactId>\n                <version>${slf4j.version}</version>\n                <scope>runtime</scope>\n                <optional>true</optional>\n            </dependency>\n    \n            \x3c!-- Apache Commons lib --\x3e\n            <dependency>\n                <groupId>commons-lang</groupId>\n                <artifactId>commons-lang</artifactId>\n                <version>2.6</version>\n            </dependency>\n            <dependency>\n                <groupId>commons-io</groupId>\n                <artifactId>commons-io</artifactId>\n                <version>2.0.1</version>\n            </dependency>\n    \n            \x3c!-- Apache Camel --\x3e\n            <dependency>\n                <groupId>org.apache.camel</groupId>\n                <artifactId>camel-core</artifactId>\n                <version>${camel.version}</version>\n            </dependency>\n            <dependency>\n                <groupId>org.apache.camel</groupId>\n                <artifactId>camel-spring</artifactId>\n                <version>${camel.version}</version>\n            </dependency>\n            <dependency>\n                <groupId>org.apache.camel</groupId>\n                <artifactId>camel-groovy</artifactId>\n                <version>${camel.version}</version>\n            </dependency>\n            <dependency>\n                <groupId>org.apache.camel</groupId>\n                <artifactId>camel-jackson</artifactId>\n                <version>${camel.version}</version>\n            </dependency>\n            <dependency>\n                <groupId>org.apache.camel</groupId>\n                <artifactId>camel-mina</artifactId>\n                <version>${camel.version}</version>\n            </dependency>\n    \n        </dependencies>\n    \n    </project>\n')])])]),t("p",[e._v("This "),t("code",[e._v("pom.xml")]),e._v(" decalares a Java based application and it will produce "),t("code",[e._v("jar")]),e._v(". It requires minimal of JDK 6 or higher. Besides the typical "),t("code",[e._v("junit")]),e._v(" and "),t("code",[e._v("hamcrest")]),e._v(" for unit testing, I also added "),t("code",[e._v("slf4j")]),e._v(" for logging. I have added couple Apache's "),t("code",[e._v("commons-lang/io")]),e._v(" to the project as well. I think these are basic settings that any Java based application should use them.")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("maven-assembly-plugin")]),e._v(" I have declared is only for this demo packging purpose, and you may change or remove to suite your own project need.")]),e._v(" "),t("p",[e._v("For Camel dependencies, you would need minimal "),t("code",[e._v("camel-core")]),e._v(" for routes building. And then you can add any additional components you plan to use in your project. I have added the following for building typical message based application development:")]),e._v(" "),t("ol",[t("li",[e._v("The "),t("code",[e._v("camel-spring")]),e._v(" - we want to have option to declare Camel routes in xml files as configuration. See "),t("code",[e._v("camel-demo/config")]),e._v(" directory for samples.")]),e._v(" "),t("li",[e._v("The "),t("code",[e._v("camel-jackson")]),e._v(" - we want to process messaging data in our application as JSON format.")]),e._v(" "),t("li",[e._v("The "),t("code",[e._v("camel-mina")]),e._v(" - we want to send messaging data accross network through TCP socket.")]),e._v(" "),t("li",[e._v("The "),t("code",[e._v("camel-groovy")]),e._v(" - [optional] we want to be able to add dynamic scripting to route, even inside the xml config. This is great for debug and POC.")])]),e._v(" "),t("p",[e._v("Note that since we use multiple camel components dependencies, I choose to set a Maven property "),t("code",[e._v("${camel.version}")]),e._v(" so that when we upgrade Camel,\nit's easier to maintain the "),t("code",[e._v("pom.xml")]),e._v(" file in one place.")]),e._v(" "),t("p",[e._v("You should able to cd into the project directory and run "),t("code",[e._v("mvn compile")]),e._v(" to verify that the project. It should compile without error.")]),e._v(" "),t("h1",{attrs:{id:"improving-startup-of-routes-with-a-camelrunner"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#improving-startup-of-routes-with-a-camelrunner"}},[e._v("#")]),e._v(" Improving startup of routes with a CamelRunner")]),e._v(" "),t("p",[e._v("With the project "),t("code",[e._v("pom.xml")]),e._v(" file ready, you can start creating Camel routes to handle your own business logics. Before we get too excited, let's try out\na simple "),t("code",[e._v("HelloRoute")]),e._v(" to see how it works and how we can run it first. Here is the route defnition code in "),t("code",[e._v("src/main/java/deng/cameldemo/HelloRoute.java")]),e._v(".")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('    package deng.cameldemo;\n    \n    import org.apache.camel.builder.RouteBuilder;\n    \n    public class HelloRoute extends RouteBuilder {\n        @Override\n        public void configure() throws Exception {\n            from("timer://helloTimer?period=3000").\n                to("log:" + getClass().getName());\n        }\n    }\n')])])]),t("h2",{attrs:{id:"take-a-test-ride-with-the-camel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#take-a-test-ride-with-the-camel"}},[e._v("#")]),e._v(" Take a test ride with the Camel")]),e._v(" "),t("p",[e._v("To see above in action, we need to add it into a "),t("code",[e._v("CamelContext")]),e._v(" and start the context. For Java standalone program, we would write this setup code\nin a "),t("code",[e._v("Main")]),e._v(" class. The Camel actually comes with a "),t("code",[e._v("org.apache.camel.main.MainSupport")]),e._v(" abstract class that you may use to extend your own "),t("code",[e._v("Main")]),e._v(".\nHowever, I think it would be even nicer if Camel would provide a "),t("code",[e._v("CamelRunner")]),e._v(" that can run like this.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("$ java CamelRunner deng.cameldemo.HelloRoute\n")])])]),t("p",[e._v("Such "),t("code",[e._v("CamelRunner")]),e._v(" would be very user friendly and re-usable to have, so that's what I did. I wrote one like this:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('    package deng.cameldemo;\n    \n    import org.apache.camel.CamelContext;\n    import org.apache.camel.builder.RouteBuilder;\n    import org.apache.camel.impl.DefaultCamelContext;\n    import org.slf4j.Logger;\n    import org.slf4j.LoggerFactory;\n    import org.springframework.context.ConfigurableApplicationContext;\n    import org.springframework.context.support.FileSystemXmlApplicationContext;\n    \n    /** \n     * A main program to start Camel and run as a server using RouteBuilder class names or \n     * Spring config files.\n     * \n     * <p>Usage:\n     * \n     * java deng.cameldemo.CamelRunner deng.cameldemo.HelloRoute\n     * \n     * or\n     * \n     * java -Dspring=true deng.cameldemo.CamelRunner /path/to/camel-spring.xml\n     * \n     * @author Zemian Deng\n     */\n    public class CamelRunner {\n        public static void main(String[] args) throws Exception {\n            CamelRunner runner = new CamelRunner();\n            runner.run(args);\n        }\n    \n        private static Logger logger = LoggerFactory.getLogger(CamelRunner.class);\n        public void run(String[] args) throws Exception {\n            if (Boolean.parseBoolean(System.getProperty("spring", "false")))\n                runWithSpringConfig(args);\n            else\n                runWithCamelRoutes(args);\n    \n            // Wait for user to hit CRTL+C to stop the service\n            synchronized(this) {\n                this.wait();\n            }\n        }\n    \n        private void runWithSpringConfig(String[] args) {\n            final ConfigurableApplicationContext springContext = new FileSystemXmlApplicationContext(args);\n    \n            // Register proper shutdown.\n            Runtime.getRuntime().addShutdownHook(new Thread() { \n                @Override\n                public void run() {\n                    try {\n                        springContext.close();\n                        logger.info("Spring stopped.");\n                    } catch (Exception e) {\n                        logger.error("Failed to stop Spring.", e);\n                    }\n                }\n            });\n    \n            // Start spring\n            logger.info("Spring started.");\n        }\n    \n        private void runWithCamelRoutes(String[] args) throws Exception {\n            final CamelContext camelContext = new DefaultCamelContext();        \n            // Register proper shutdown.\n            Runtime.getRuntime().addShutdownHook(new Thread() { \n                @Override\n                public void run() {\n                    try {\n                        camelContext.stop();\n                        logger.info("Camel stopped for {}", camelContext);\n                    } catch (Exception e) {\n                        logger.error("Failed to stop Camel.", e);\n                    }\n                }\n            });\n    \n            // Added RouteBuilder from args\n            for (String className : args) {\n                Class<?> cls = Class.forName(className);\n                if (RouteBuilder.class.isAssignableFrom(cls)) {\n                    Object obj = cls.newInstance();\n                    RouteBuilder routeBuilder = (RouteBuilder)obj;\n                    camelContext.addRoutes(routeBuilder);\n                } else {\n                    throw new RuntimeException("Unable to add Camel RouteBuilder " + className);\n                }\n            }\n    \n            // Start camel\n            camelContext.start();\n            logger.info("Camel started for {}", camelContext);\n        }\n    }\n')])])]),t("p",[e._v("To help you run the main class, I have provided a "),t("a",{attrs:{href:"http://saltnlight5.blogspot.com/2012/08/a-better-java-shell-script-wrapper.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("run-java"),t("OutboundLink")],1),e._v("\nwrapper script under the project's "),t("code",[e._v("bin")]),e._v(" directory, so that you may quickly test it without having to setup classpath.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("$ mvn package\n$ bin/run-java deng.cameldemo.CamelRunner deng.cameldemo.HelloRoute\n")])])]),t("p",[e._v("You will see that the program will load the "),t("code",[e._v("HelloRoute")]),e._v(" in a "),t("code",[e._v("DefaultCamelContext")]),e._v(" and start it as a server. The "),t("code",[e._v("HelloRoute")]),e._v(" itself will\ngenerate a 3 seconds timer message and send it to a logger, which should be printing onto your console screen. This will continue forever\nuntil you hit "),t("code",[e._v("CTRL+C")]),e._v(" to end it.")]),e._v(" "),t("p",[e._v("NOTE: You only have to invoke "),t("code",[e._v("mvn package")]),e._v(" command once, so that it will package up all the dependencies jars in order for "),t("code",[e._v("run-java")]),e._v(" to auto-detect\nthem. If you are not going to use "),t("code",[e._v("maven-assembly-plugin")]),e._v(" during "),t("code",[e._v("package")]),e._v(" phase, then use "),t("code",[e._v("mvn dependency:copy-dependencies")]),e._v(" command\nexplicitly will work fine as well.")]),e._v(" "),t("h2",{attrs:{id:"take-a-test-ride-with-the-camel-part-2-running-camel-with-spring-xml-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#take-a-test-ride-with-the-camel-part-2-running-camel-with-spring-xml-configuration"}},[e._v("#")]),e._v(" Take a test ride with the Camel, Part 2: running Camel with Spring xml configuration")]),e._v(" "),t("p",[e._v("The "),t("code",[e._v("HelloRoute")]),e._v(" example above would simply provide route definition that formed by using component URI's. It will be nice if\nwe can configure the route in a declarative manner so that we may change the route without re-compile a class file. This will be very handy especially\nif you are not familiar with each component's options and want to explore and try things out. Well, that's what the "),t("code",[e._v("camel-spring")]),e._v(" is for. Beside\ngiving you an option to load route in xml config file, it also provides a very flexible way to register custom services/processors bean in the Spring\nIoC container.")]),e._v(" "),t("p",[e._v("If you are a keen reader, you will notice in the "),t("code",[e._v("CamelRunner")]),e._v(" code above that it has an extra "),t("code",[e._v("runWithSpringConfig")]),e._v(" part. So the "),t("code",[e._v("CamelRunner")]),e._v("\ncan actually bootstrap any Spring xml file and start a context as a server. You may use it like this:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("$ bin/run-java deng.cameldemo.CamelRunner -Dspring=true config/hellocamel-spring.xml\n")])])]),t("p",[e._v("The "),t("code",[e._v("config/hellocamel-spring.xml")]),e._v(" is just an equivalent of our "),t("code",[e._v("HelloRoute")]),e._v(" code but in Spring xml form:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('    <beans xmlns="http://www.springframework.org/schema/beans"\n        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n        xsi:schemaLocation="\n            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n            http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">\n    \n        <camelContext id="helloCamel" xmlns="http://camel.apache.org/schema/spring">\n            <route>\n                <from uri="timer://jdkTimer?period=3000"/>\n                <to uri="log://deng.cameldemo.HelloCamel"/>\n            </route>\n        </camelContext>\n    \n    </beans>\n')])])]),t("p",[e._v("This remove the need to compile/re-compile "),t("code",[e._v("HelloRoute")]),e._v(" to define the Camel route to run.")]),e._v(" "),t("h1",{attrs:{id:"building-message-based-application-using-camel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#building-message-based-application-using-camel"}},[e._v("#")]),e._v(" Building message based application using Camel")]),e._v(" "),t("p",[e._v("To present you with a more practical demo, I would show you further on how to setup Camel to process message based application. In many IT\nshops, it's common that you would have a server to take message data as input and process them. A practical use case is to take any JSON\nformated message and transform it into object and process it. To do this in Camel, what you want to build is a route that will take\ninput messages from a TCP port, and then process it in a pipeflow with any business logic you may have. You will run the route as a server,\nand then client may use any mean to submit the message to the TCP port. Client may even be another thin Camel client app to submit data as well.\nLet me show you how to get started.")]),e._v(" "),t("h2",{attrs:{id:"writing-the-server-side-code-with-camel-route"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#writing-the-server-side-code-with-camel-route"}},[e._v("#")]),e._v(" Writing the server side code with Camel route")]),e._v(" "),t("p",[e._v("The server side would need a route to listen from a TCP port, and this is provided by "),t("code",[e._v("camel-mina")]),e._v(" component. The first step is you need a route.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('    package deng.cameldemo;\n    \n    import org.apache.camel.builder.RouteBuilder;\n    \n    public class TcpMsgRoute extends RouteBuilder {\n        @Override\n        public void configure() throws Exception {\n            String port = System.getProperty("port", "12345");\n            from("mina:tcp://localhost:" + port + "?sync=false").\n                to("log:" + getClass().getName());\n        }\n    }\n')])])]),t("p",[e._v("Then the next step is ... done! No way, you mean that's all there to it for a server? Too good to be true? Well, let's try it out")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("    $ bin/run-java deng.cameldemo.CamelRunner deng.cameldemo.TcpMsgRoute -Dport=12345\n    15:21:41 main INFO  org.apache.camel.impl.DefaultCamelContext:1391 | Apache Camel 2.10.1 (CamelContext: camel-1) is starting\n    15:21:41 main INFO  org.apache.camel.management.ManagementStrategyFactory:43 | JMX enabled.\n    15:21:42 main INFO  org.apache.camel.impl.converter.DefaultTypeConverter:45 | Loaded 172 type converters\n    15:21:42 main INFO  org.apache.camel.component.mina.MinaConsumer:59 | Binding to server address: localhost/127.0.0.1:12345 using acceptor: org.apache.mina.transport.socket.nio.SocketAcceptor@2ffad8fe\n    15:21:42 main INFO  org.apache.camel.impl.DefaultCamelContext:2045 | Route: route1 started and consuming from: Endpoint[mina://tcp://localhost:12345?sync=true]\n    15:21:42 main INFO  org.apache.camel.management.DefaultManagementLifecycleStrategy:859 | StatisticsLevel at All so enabling load performance statistics\n    15:21:42 main INFO  org.apache.camel.impl.DefaultCamelContext:1426 | Total 1 routes, of which 1 is started.\n    15:21:42 main INFO  org.apache.camel.impl.DefaultCamelContext:1427 | Apache Camel 2.10.1 (CamelContext: camel-1) started in 0.505 seconds\n    15:21:42 main INFO  deng.cameldemo.CamelRunner:93 | Camel started for CamelContext(camel-1)\n")])])]),t("p",[e._v("Voila! The server is up and waiting for your users to send messages through port "),t("code",[e._v("12345")]),e._v(". Not too bad for few lines of code.")]),e._v(" "),t("h2",{attrs:{id:"writing-the-client-side-code-with-camel-producertemplate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#writing-the-client-side-code-with-camel-producertemplate"}},[e._v("#")]),e._v(" Writing the client side code with Camel ProducerTemplate")]),e._v(" "),t("p",[e._v("Since our server expose a TCP port and take in any text content message, you can create any client that's capable writing to a TCP socket. In here,\nI will show you how to use Camel to write a thin client.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('    package deng.cameldemo.client;\n    \n    import java.io.FileReader;\n    import org.apache.camel.CamelContext;\n    import org.apache.camel.ProducerTemplate;\n    import org.apache.camel.impl.DefaultCamelContext;\n    import org.apache.commons.io.IOUtils;\n    import org.slf4j.Logger;\n    import org.slf4j.LoggerFactory;\n    \n    public class TcpMsgSender {\n        public static void main(String[] args) throws Exception {\n            TcpMsgSender runner = new TcpMsgSender();\n            runner.run(args);\n        }\n    \n        private static Logger logger = LoggerFactory.getLogger(TcpMsgSender.class);\n        public void run(String[] args) throws Exception {\n            String fileName = args.length > 0 ? args[0] : "data/msg.txt";\n            String[] hostPort = (args.length > 1 ? args[1] : "localhost:12345").split(":");\n            String host = hostPort[0];\n            String port = hostPort.length > 1 ? hostPort[1] : "12345";\n            logger.info("Sending tcp message {} to host={}, port={}", new Object[]{ fileName, host, port});\n    \n            String text = IOUtils.toString(new FileReader(fileName));\n            logger.debug("File size={}", text.length());\n    \n            CamelContext camelContext = new DefaultCamelContext();\n            ProducerTemplate producer = camelContext.createProducerTemplate();\n            producer.sendBody("mina:tcp://" + host + ":" + port + "?sync=false", text);\n            logger.info("Message sent.");\n        }\n    }\n')])])]),t("p",[e._v("This "),t("code",[e._v("TcpMsgSender")]),e._v(" can send any text file to your server endpoint. Try this out while your server is running:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("    $ bin/run-java deng.cameldemo.client.TcpMsgSender data/test-msg.json localhost:12345\n    15:22:35 main INFO  deng.cameldemo.client.TcpMsgSender:24 | Sending tcp message data/test-msg.json to host=localhost, port=12345\n    15:22:35 main DEBUG deng.cameldemo.client.TcpMsgSender:27 | File size=47\n    15:22:35 main INFO  org.apache.camel.impl.converter.DefaultTypeConverter:45 | Loaded 172 type converters\n    15:22:35 main INFO  org.apache.camel.management.ManagementStrategyFactory:43 | JMX enabled.\n    15:22:35 main INFO  deng.cameldemo.client.TcpMsgSender:32 | Message sent.\n")])])]),t("p",[e._v("You should able to verify from your server console output that it received the msg. The msg I sent is in "),t("code",[e._v("data/test-msg.json")]),e._v(", which\ncontains this simple text:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v('{ "firstName" : "Zemian", "lastName" : "Deng" }\n')])])]),t("p",[e._v("Note that our server simply receive plain text and log it. We will discuss how to process the message next.")]),e._v(" "),t("h2",{attrs:{id:"processing-message-data-in-json-format-with-camel-and-spring-xml-config"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#processing-message-data-in-json-format-with-camel-and-spring-xml-config"}},[e._v("#")]),e._v(" Processing message data in JSON format with Camel and Spring xml config")]),e._v(" "),t("p",[e._v("You thought the server code was easy from above, guess again. You can actually replace the "),t("code",[e._v("TcpMsgRoute")]),e._v(" with just some simple xml lines!")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('    <beans xmlns="http://www.springframework.org/schema/beans"\n        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n        xsi:schemaLocation="\n            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n            http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">\n    \n        <camelContext id="tcpMsgServer" xmlns="http://camel.apache.org/schema/spring">\n            <route>\n                <from uri="mina:tcp://localhost:12345?sync=false"/>\n                <to uri="log://deng.cameldemo.TcpMsgServer"/>\n            </route>\n        </camelContext>\n    \n    </beans>\n')])])]),t("p",[e._v("Save it as "),t("code",[e._v("config/tcpmsgserver-spring.xml")]),e._v(". Then re-run the server, and you should get the same result as above.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("$ bin/run-java deng.cameldemo.CamelRunner -Dspring=true config/tcpmsgserver-spring.xml\n")])])]),t("p",[e._v("Now let us improve the above xml to further process the JSON message data. We will like to transform the plain text to a Java object then process\nby a custom bean. To do that, we first would need to add unmarshal component to the route. This is where the "),t("code",[e._v("camel-jackson")]),e._v(" comes into play.\nIn our demo, the unmarshalling step would convert the JSON text into a "),t("code",[e._v("java.util.Map")]),e._v(" and then pass it to a processor bean named "),t("code",[e._v("myMsgProcessor")]),e._v(".\nLet's create a new xml file named "),t("code",[e._v("config/tcpmsgserver-json-spring.xml")]),e._v(" as follow.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('    <beans xmlns="http://www.springframework.org/schema/beans"\n        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n        xsi:schemaLocation="\n            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\n            http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">\n    \n        <camelContext id="tcpMsgServer" xmlns="http://camel.apache.org/schema/spring">\n            <route>\n                <from uri="mina:tcp://localhost:12345?sync=false"/>\n                <to uri="log://deng.cameldemo.TcpMsgServer"/>\n                <unmarshal>\n                    <json library="Jackson"/>\n                </unmarshal>\n                <to uri="bean:myMsgProcessor?method=process"/>\n            </route>\n        </camelContext>\n    \n        <bean id="myMsgProcessor" class="deng.cameldemo.MyMsgProcessor">\n        </bean>\n    \n    </beans>\n')])])]),t("p",[e._v("The "),t("code",[e._v("myMsgProcessor")]),e._v(" is an Spring bean that we provide custom logic code to process the data. At this point we have a full Java object\nto manipulate. The content of the processor can be any POJO with the method name specified in the URI. Here is an example one:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('    package deng.cameldemo;\n    \n    import org.apache.camel.builder.RouteBuilder;\n    import org.slf4j.Logger;\n    import org.slf4j.LoggerFactory;\n    import java.util.Map;\n    \n    public class MyMsgProcessor {\n        private static Logger logger = LoggerFactory.getLogger(MyMsgProcessor.class);\n        public void process(Map<String, String> data) {\n            logger.info("We should slice and dice the data: " + data);\n        }\n    }\n')])])]),t("p",[e._v("Try re-run the server with the new xml file above, and you should able to re-invoke the same client command to test it out. Here is a sample\noutput of my server:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('    $ bin/run-java deng.cameldemo.CamelRunner -Dspring=true config/tcpmsgserver-json-spring.xml\n    17:05:25 main INFO  org.springframework.context.support.FileSystemXmlApplicationContext:456 | Refreshing org.springframework.context.support.FileSystemXmlApplicationContext@4200309: startup date [Sat Sep 15 17:05:25 EDT 2012]; root of context hierarchy\n    17:05:25 main INFO  org.springframework.beans.factory.xml.XmlBeanDefinitionReader:315 | Loading XML bean definitions from file [/Users/zemian/projects/sandbox/camel-demo/config/tcpmsgserver-json-spring.xml]\n    17:05:27 main INFO  org.springframework.beans.factory.support.DefaultListableBeanFactory:557 | Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@27b75165: defining beans [template,consumerTemplate,tcpMsgServer:beanPostProcessor,tcpMsgServer,myMsgProcessor]; root of factory hierarchy\n    17:05:27 main INFO  org.apache.camel.spring.SpringCamelContext:1391 | Apache Camel 2.10.1 (CamelContext: tcpMsgServer) is starting\n    17:05:27 main INFO  org.apache.camel.management.ManagementStrategyFactory:43 | JMX enabled.\n    17:05:27 main INFO  org.apache.camel.impl.converter.DefaultTypeConverter:45 | Loaded 172 type converters\n    17:05:28 main INFO  org.apache.camel.component.mina.MinaConsumer:59 | Binding to server address: localhost/127.0.0.1:12345 using acceptor: org.apache.mina.transport.socket.nio.SocketAcceptor@5a3cae4a\n    17:05:28 main INFO  org.apache.camel.spring.SpringCamelContext:2045 | Route: route1 started and consuming from: Endpoint[mina://tcp://localhost:12345?sync=false]\n    17:05:28 main INFO  org.apache.camel.management.DefaultManagementLifecycleStrategy:859 | StatisticsLevel at All so enabling load performance statistics\n    17:05:28 main INFO  org.apache.camel.spring.SpringCamelContext:1426 | Total 1 routes, of which 1 is started.\n    17:05:28 main INFO  org.apache.camel.spring.SpringCamelContext:1427 | Apache Camel 2.10.1 (CamelContext: tcpMsgServer) started in 0.695 seconds\n    17:05:28 main INFO  deng.cameldemo.CamelRunner:61 | Spring started.\n    17:05:35 Camel (tcpMsgServer) thread #3 - MinaThreadPool INFO  deng.cameldemo.TcpMsgServer:96 | Exchange[ExchangePattern:InOnly, BodyType:String, Body:{ "firstName" : "Zemian", "lastName" : "Deng" }]\n    17:05:35 Camel (tcpMsgServer) thread #3 - MinaThreadPool INFO  deng.cameldemo.MyMsgProcessor:11 | We should slice and dice the data: {lastName=Deng, firstName=Zemian}\n')])])]),t("p",[e._v("Pay attention that Camel will auto convert the data format in your route! Our client only sends the plain text as JSON format, but when\nserver receives it, it unmarshals it using Jackson library, and then converts it into a java Map object. It then passes the map object into our\nprocessor bean. Also, in this demo, I choose to use a generic "),t("code",[e._v("java.util.Map")]),e._v(" as processor method argument (which is output of the JSON unmarshal), but\nyou can easily define your own business data type, such as "),t("code",[e._v("MyCustomerData")]),e._v('. This reveals the power of Camel, since you don\'t need to push the message\nin your flow, but only worry about writing your "processor" as a POJO. The Camel will "glue" components together to form a route and carry the message data through the pipeline flow.')]),e._v(" "),t("p",[e._v("On the same token, when you write your business logic in one or more processors, it's a good idea that you limit your POJO logic to be as small\nunit as possible. When you do this, then you can maximize the reusability of the processors. The bigger POJO you make, with many business logics mixed in, it will also make it\ndifficult to test. So I recommend you when developing these processor beans, try to think them as LEGO pieces -- small POJO. You want to let Camel define the route and glue the LEGO\npieces togther. Once you get into this habit of thiking, then you can use Camel in a more effectively way to solve many of your domain problems.")]),e._v(" "),t("p",[e._v("Well, that's all for today folks. I hope you enjoyed the Camel ride. Happy programming!")])])}),[],!1,null,null,null);a.default=o.exports}}]);