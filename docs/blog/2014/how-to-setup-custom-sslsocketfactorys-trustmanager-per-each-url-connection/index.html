<!DOCTYPE html>
<html>
    <head lang="en">
        <title>How to setup custom SSLSocketFactory&#039;s TrustManager per each URL connection &mdash; Zemian&#039;s Blog</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
            <meta name="robots" content="index, follow">
        <link rel="stylesheet" href="/build/app.css">

        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Zemian&#039;s Blog activity feed" />
                                        
                <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135626598-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-135626598-1');
        </script>
        
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1148923977922702" crossorigin="anonymous"></script>
            </head>
    <body>

    <div id="app">
        <div class="navbar is-primary">
            <div class="container">
                <div class="navbar-brand">
                    <a class="navbar-item" href="/">
                        <img src="/build/images/zblog.svg" height="28">
                    </a>

                    <a class="navbar-burger" id="navbarMenuButton">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                <div class="navbar-menu" id="navbarMenu">
                    <div class="navbar-end is-size-4">
                        <a href="/tags" class="navbar-item">Tags</a>
                        <a href="/about" class="navbar-item">About</a>
                        <a href="/atom.xml" class="navbar-item">Feed</a>
                        <a href="/search" class="navbar-item">Search</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="container">
                <div class="columns is-centered">
                    <div class="column is-two-thirds">
                            <div class="level">
        <div class="level-item">
            Oct 28, 2014
        </div>
    </div>
    <div class="level">
        <div class="level-item">
                        <a class="tag mr-1" href="/blog/tags/ssh">ssh</a>
                        <a class="tag mr-1" href="/blog/tags/java">java</a>
                    </div>
    </div>

    <h1 class="title">How to setup custom SSLSocketFactory&#039;s TrustManager per each URL connection</h1>
    <div class="content">
        <p>We can see from javadoc that javax.net.ssl.HttpsURLConnection provided a static method to override with setDefaultSSLSocketFory() method. This allow you to supply a custom javax.net.ssl.TrustManager that may verify your own  CA certs handshake and validation etc. But this will override the default for all "https" URLs per your JVM!</p>

<p>So how can we override just a single https URL? Looking at javax.net.ssl.HttpsURLConnection again we see instance method for setSSLSocketFactory(), but we can't instantiate HttpsURLConnection object directly! It took me some digging to realized that the java.net.URL is actually an factory class for its implementation! One can get an instance like this using new URL("https://localhost").openConnection()</p>

<p>To complete this article, I will provide a simple working example that demonstrate this.</p>

<pre><code>package zemian;

import java.io.BufferedReader;

import java.io.InputStream;

import java.io.InputStreamReader;

import java.net.URL;

import java.net.URLConnection;

import java.security.SecureRandom;

import java.security.cert.X509Certificate;

import javax.net.ssl.HttpsURLConnection;

import javax.net.ssl.SSLContext;

import javax.net.ssl.SSLSocketFactory;

import javax.net.ssl.TrustManager;

import javax.net.ssl.X509TrustManager;

public class WGetText {

    public static void main(String[] args) throws Exception {

        String urlString = System.getProperty("url", "https://google.com");

        URL url = new URL(urlString);

        URLConnection urlConnection = url.openConnection();

        HttpsURLConnection httpsUrlConnection = (HttpsURLConnection) urlConnection;

        SSLSocketFactory sslSocketFactory = createTrustAllSslSocketFactory();

        httpsUrlConnection.setSSLSocketFactory(sslSocketFactory);

        try (InputStream inputStream = httpsUrlConnection.getInputStream()) {

            BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream));

            String line = null;

            while ((line = reader.readLine()) != null) {

                System.out.println(line);

            }

        }

    }

    private static SSLSocketFactory createTrustAllSslSocketFactory() throws Exception {

        TrustManager[] byPassTrustManagers = new TrustManager[] { new X509TrustManager() {

            public X509Certificate[] getAcceptedIssuers() {

                return new X509Certificate[0];

            }

            public void checkClientTrusted(X509Certificate[] chain, String authType) {

            }

            public void checkServerTrusted(X509Certificate[] chain, String authType) {

            }

        } };

        SSLContext sslContext = SSLContext.getInstance("TLS");

        sslContext.init(null, byPassTrustManagers, new SecureRandom());

        return sslContext.getSocketFactory();

    }

}
</code></pre>

    </div>

        <br/>
    <ul>
                <li class="block">Next: <a href="/blog/2014/how-to-use-ssh-tunneling-to-get-to-your-restricted-servers" title="How to use SSH tunneling to get to your restricted servers"><span>How to use SSH tunneling to get to your restricted servers</span></a></li>
                        <li class="block">Previous: <a href="/blog/2014/how-servlet-and-jsp-create-sessions" title="How Servlet and JSP create sessions"><span>How Servlet and JSP create sessions</span></a></li>
            </ul>
    
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="columns">
                <div class="column">
                    <div class="level">
                        <div class="level-item">
                            <a href="https://bulma.io">
                                <img
                                    src="/build/images/made-with-bulma.png"
                                    alt="Made with Bulma"
                                    width="128"
                                    height="24">
                            </a>
                            <a href="https://sculpin.io" class="mx-3">
                                <div class="width: 128px; height: 24px;">
                                <img
                                    src="/build/images/sculpin-mascot-jackson-micro.png"
                                    alt="Made with Sculpin"
                                    width="100%"
                                    height="100%">
                                </div>
                            </a>
                        </div>
                    </div>
                    <div class="level">
                        <div class="level-item">
                            <a href="/sitemap.xml">
                                SiteMap
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Script to enable responsive navbar hamburger menu -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.querySelector('#navbarMenuButton');
            btn.addEventListener('click', () => {
                btn.classList.toggle('is-active');
                const menu = document.querySelector('#navbarMenu');
                menu.classList.toggle('is-active');
            });
        });
    </script>

        <script src="/build/app.js"></script>
    
        
    </body>
</html>
