<!DOCTYPE html>
<html>
    <head lang="en">
        <title>Reading https url from a self-signed cert &mdash; Zemian&#039;s Blog</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
            <meta name="robots" content="index, follow">
        <link rel="stylesheet" href="/build/app.css">

        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Zemian&#039;s Blog activity feed" />
                                        
                <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135626598-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-135626598-1');
        </script>
        
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1148923977922702" crossorigin="anonymous"></script>
            </head>
    <body>

    <div id="app">
        <div class="navbar is-primary">
            <div class="container">
                <div class="navbar-brand">
                    <a class="navbar-item" href="/">
                        <img src="/build/images/zblog.svg" height="28">
                    </a>

                    <a class="navbar-burger" id="navbarMenuButton">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                <div class="navbar-menu" id="navbarMenu">
                    <div class="navbar-end is-size-4">
                        <a href="/tags" class="navbar-item">Tags</a>
                        <a href="/about" class="navbar-item">About</a>
                        <a href="/atom.xml" class="navbar-item">Feed</a>
                        <a href="/search" class="navbar-item">Search</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="container">
                <div class="columns is-centered">
                    <div class="column is-two-thirds">
                            <div class="level">
        <div class="level-item">
            Dec 26, 2012
        </div>
    </div>
    <div class="level">
        <div class="level-item">
                        <a class="tag mr-1" href="/blog/tags/groovy">groovy</a>
                    </div>
    </div>

    <h1 class="title">Reading https url from a self-signed cert</h1>
    <div class="content">
        <p>Groovy has made fetching data from URL a snap:</p>

<pre><code>println(new URL("http://www.google.com").text)
</code></pre>

<p>But have you ever try to get data from an <code>https</code> of an site that's using a self signed certificate? A browser will prompt you a risk warning, but it let you trust it and still continue. But it's much more hassle if we want to fetch the data programmatically. For example, try fetching <a href="https://www.pcwebshop.co.uk/">https://www.pcwebshop.co.uk</a> and you will see that it failed miserably:</p>

<pre><code>    Caught: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
    javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
        at com.sun.net.ssl.internal.ssl.Alerts.getSSLException(Alerts.java:174)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1762)
        at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:241)
        at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:235)
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1206)
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:136)
        at com.sun.net.ssl.internal.ssl.Handshaker.processLoop(Handshaker.java:593)
        at com.sun.net.ssl.internal.ssl.Handshaker.process_record(Handshaker.java:529)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:958)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1203)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1230)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1214)
        at test.run(test.groovy:2)
    Caused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
        at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:126)
        at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:209)
        at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:249)
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1185)
        ... 8 more
    Caused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
        ... 12 more
</code></pre>

<p>This is due to Java API won't let you get data if your certs is not in the keystore or "trusted". Now if you have your own testing site and did a self-signed like above, then sure you just want to trust it temporary and simply want to fetch the data. However configuring the Java API to do such simple task is a nightmare.</p>

<p>Today, I found a library that allow you to perform exactly this: <a href="https://github.com/kevinsawicki/http-request">https://github.com/kevinsawicki/http-request</a> Trying this out using Groovy is pretty sweet:</p>

<pre><code>    @Grab('com.github.kevinsawicki:http-request:3.1')
    import com.github.kevinsawicki.http.*
    def req = HttpRequest.get("https://www.pcwebshop.co.uk")
    req.trustAllCerts()
    req.trustAllHosts()
    println(req.body())
</code></pre>

<p>And Voila! We read the URL context without the pesky exception. This <code>http-request</code> is awesome! Now I wish JDK let you do simple thing like this. This is extremely useful for testing.</p>

    </div>

        <br/>
    <ul>
                <li class="block">Next: <a href="/blog/2012/java-implementation-of-stringnext-successor" title="Java implementation of String#next() successor"><span>Java implementation of String#next() successor</span></a></li>
                        <li class="block">Previous: <a href="/blog/2012/a-strange-case-of-java-generic-and-inheritage-parameter-passing" title="A strange case of Java generic and inheritage parameter passing"><span>A strange case of Java generic and inheritage parameter passing</span></a></li>
            </ul>
    
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="columns">
                <div class="column">
                    <div class="level">
                        <div class="level-item">
                            <a href="https://bulma.io">
                                <img
                                    src="/build/images/made-with-bulma.png"
                                    alt="Made with Bulma"
                                    width="128"
                                    height="24">
                            </a>
                            <a href="https://sculpin.io" class="mx-3">
                                <div class="width: 128px; height: 24px;">
                                <img
                                    src="/build/images/sculpin-mascot-jackson-micro.png"
                                    alt="Made with Sculpin"
                                    width="100%"
                                    height="100%">
                                </div>
                            </a>
                        </div>
                    </div>
                    <div class="level">
                        <div class="level-item">
                            <a href="/sitemap.xml">
                                SiteMap
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Script to enable responsive navbar hamburger menu -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.querySelector('#navbarMenuButton');
            btn.addEventListener('click', () => {
                btn.classList.toggle('is-active');
                const menu = document.querySelector('#navbarMenu');
                menu.classList.toggle('is-active');
            });
        });
    </script>

        <script src="/build/app.js"></script>
    
        
    </body>
</html>
