<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>A simple way to setup Java application with external configuration file</title>
        <link rel="stylesheet" href="https://zemian.github.io/theme/css/main.css" />
        <link href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ZBlog Atom Feed" />
        <meta name="description" content="Many Java applications would deploy and run it with some kind of external configuration files. It's very typical that you would want a set of..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://zemian.github.io/">ZBlog</a></h1>
                <nav><ul>
                    <li><a href="https://zemian.github.io/pages/about-the-author.html">About The Author</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://zemian.github.io/2012/a-simple-way-to-setup-java-application-with-external-configuration-file.html" rel="bookmark"
           title="Permalink to A simple way to setup Java application with external configuration file">A simple way to setup Java application with external configuration file</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-10-27T00:00:00-05:00">
                Published: Sat 27 October 2012
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://zemian.github.io/author/zemian-deng.html">Zemian Deng</a>
        </address>
<p>In <a href="https://zemian.github.io/category/blog.html">Blog</a>.</p>
<p>tags: <a href="https://zemian.github.io/tag/java.html">java</a> </p>
</footer><!-- /.post-info -->      <p>Many Java applications would deploy and run it with some kind of external configuration files. It's very typical that you would want a set of config files per environments such as DEV, QA and PROD. There many options in tackling this problem, especially in a Java app, but keeping it simple and easy to maintain would take some disciplines.</p>
<p>Here I would layout a simple way you may use to depploy a typical Java application. The concept is simple and you can easily apply to a standalone, web, or even a JEE application.</p>
<h2>Use a env System Properties per environment</h2>
<p>Java allows you to invoke any program with extra System Properties added. When launching an Java application, you should set an <code>env</code> property. For example:</p>
<div class="highlight"><pre><span></span><code>bash&gt; java -Denv=prod myapp.Main
</code></pre></div>

<p>This property would give your <code>Main</code> application to identify which environment you are running against with. You should be reading it like this inside your code:</p>
<div class="highlight"><pre><span></span><code>String env = System.getProperty(&quot;env&quot;, &quot;dev&quot;);
</code></pre></div>

<p>This way you always would have an environment to work with. Even if user doesn't supply one, it will default to use <code>dev</code> env.</p>
<p>Another useful System Property to set is <code>app.home</code>. You want to set this value in relative to where your application is deployed, so you may reference any files (eg: data) easily. To do this, you can use a script wrapper to automatically calculate the path. See section below for an example.</p>
<h2>Use a config dir prefix in CLASSPATH</h2>
<p>In stead of passing a explicit config file to your application as argument, another flexible way to load configuration file is to add an extra <code>config</code>
folder into your CLASSPATH. For example, you can easily create a startup wrapper script <code>myapp.sh</code> like this:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#/usr/bin/env bash</span>
<span class="n">APP_HOME</span><span class="o">=</span><span class="n">$</span><span class="p">(</span><span class="n">cd</span><span class="w"> </span><span class="s">&quot;`dirname $0`/..&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pwd</span><span class="p">)</span><span class="w"></span>
<span class="n">java</span><span class="w"> </span><span class="n">$JAVA_OPTS</span><span class="w"> </span><span class="o">-</span><span class="n">Dapp</span><span class="p">.</span><span class="n">home</span><span class="o">=</span><span class="n">$APP_HOME</span><span class="w"> </span><span class="o">-</span><span class="n">cp</span><span class="w"> </span><span class="s">&quot;$APP_HOME/config:$APP_HOME/lib/*&quot;</span><span class="w"> </span><span class="n">myapp</span><span class="p">.</span><span class="n">Main</span><span class="w"> </span><span class="s">&quot;$@&quot;</span><span class="w"></span>
</code></pre></div>

<p>From this, you can setup the application packaging layout this way:</p>
<div class="highlight"><pre><span></span><code>    myapp
        +- bin
            +- myapp.sh
        +- config
            +- dev.properties
            +- qa.properties
            +- prod.properties
        +- data
            +- myrecords.data
        +- lib
            +- myapp-1.0.0.jar
            +- slf4j-1.7.1.jar
</code></pre></div>

<p>You would typically invoke the application like this:</p>
<div class="highlight"><pre><span></span><code>bash&gt; JAVA_OPTS=&#39;-Denv=prod&#39; myapp/bin/myapp.sh
</code></pre></div>

<p>The above will give you a good foundation to load a single config properties file per <code>env</code>. For example, you can read your properites file like this somewhere in your code.</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="n">appHome</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">dir</span><span class="o">.</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">appHome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s2">&quot;app.home&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">dataDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appHome</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;/data&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="n">parameters</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s2">&quot;env&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.properites&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">Properties</span><span class="w"> </span><span class="n">configProps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Properties</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">InputStream</span><span class="w"> </span><span class="n">inStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">inStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getClass</span><span class="p">()</span><span class="o">.</span><span class="n">getClassLoader</span><span class="p">()</span><span class="o">.</span><span class="n">getResourceAsStream</span><span class="p">(</span><span class="n">config</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">configProps</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">inStream</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">finally</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">inStream</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">inStream</span><span class="o">.</span><span class="n">close</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Now</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">configProps</span><span class="w"> </span><span class="n">map</span><span class="o">.</span><span class="w"></span>
</code></pre></div>

<p>Now you would have the <code>configProps</code> object at your disposal to read any configuration keys and values set per an environment.</p>
<p>NOTE: If you want a more flexible Java wrapper script, see my old post on <a href="https://zemian.github.io/2012/08/a-better-java-shell-script-wrapper.html">run-java</a> wrapper.</p>
<h2>Do not abuse CLASSPATH</h2>
<p>Now, just because you have setup <code>config</code> as part of your CLASSPATH entry, I have to caution you not to abuse it. What I mean is do not go wild on 
loading all your application resources in that folder! If you have that many resources that user MUST edit and configure, then you should re-think
about your application design! Simple interface, or configuration in this case, is always a win. Do not bother users with complexity just because 
your application can support gazillion ways of configuration combination. If you can keep it as one config file, it would make users very happy.</p>
<p>Also, this doesn't mean you have to put the entire world inside one of <code>prod.properites</code> either. In the real world, an application is likely going to have only 
handful of user tunable parameters, and many other resources are less frequent used. I would recommand put the most frequently used parameters in these
config properties only. For all other (for example most of the Spring context files in an application do not belong to a typical users config level, they are more developer level config files. In another word, changing these files would have catastrophic effect to your application!) You should put these inside as part of your <code>myapp.jar</code>.</p>
<p>You might ask, 'Oh, but what happen if I must want to override one of 
the resource in the jar?'. But in that very unusual case, you would still have an option to override! You have the <code>config</code> as prefix in CLASSPATH, remember? Even when you nested resources inside a package inside the 
jar, you would still able to overwrite by simply create same directory structure inside <code>config</code>. You probably only do this for emmergency and less frequent use anyway.</p>
<h2>Feedback</h2>
<p>So what are some clever ways you have seen or done with your application configuration? I hope to hear from you and share.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>