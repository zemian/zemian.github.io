<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Reading https url from a self-signed cert</title>
        <link rel="stylesheet" href="https://zemian.github.io/theme/css/main.css" />
        <link href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ZBlog Atom Feed" />
        <meta name="description" content="Groovy has made fetching data from URL a snap: println(new URL("http://www.google.com").text) But have you ever try to get data from an https of..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://zemian.github.io/">ZBlog</a></h1>
                <nav><ul>
                    <li><a href="https://zemian.github.io/pages/about-the-author.html">About The Author</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://zemian.github.io/2012/reading-https-url-from-a-self-signed-cert.html" rel="bookmark"
           title="Permalink to Reading https url from a self-signed cert">Reading https url from a self-signed cert</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-12-26T00:00:00-05:00">
                Published: Wed 26 December 2012
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://zemian.github.io/author/zemian-deng.html">Zemian Deng</a>
        </address>
<p>In <a href="https://zemian.github.io/category/blog.html">Blog</a>.</p>
<p>tags: <a href="https://zemian.github.io/tag/groovy.html">groovy</a> </p>
</footer><!-- /.post-info -->      <p>Groovy has made fetching data from URL a snap:</p>
<div class="highlight"><pre><span></span><code>println(new URL(&quot;http://www.google.com&quot;).text)
</code></pre></div>

<p>But have you ever try to get data from an <code>https</code> of an site that's using a self signed certificate? A browser will prompt you a risk warning, but it let you trust it and still continue. But it's much more hassle if we want to fetch the data programmatically. For example, try fetching <a href="https://www.pcwebshop.co.uk/">https://www.pcwebshop.co.uk</a> and you will see that it failed miserably:</p>
<div class="highlight"><pre><span></span><code>    Caught: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
    javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
        at com.sun.net.ssl.internal.ssl.Alerts.getSSLException(Alerts.java:174)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1762)
        at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:241)
        at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:235)
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1206)
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:136)
        at com.sun.net.ssl.internal.ssl.Handshaker.processLoop(Handshaker.java:593)
        at com.sun.net.ssl.internal.ssl.Handshaker.process_record(Handshaker.java:529)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:958)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1203)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1230)
        at com.sun.net.ssl.internal.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1214)
        at test.run(test.groovy:2)
    Caused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
        at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:126)
        at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:209)
        at com.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:249)
        at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1185)
        ... 8 more
    Caused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
        ... 12 more
</code></pre></div>

<p>This is due to Java API won't let you get data if your certs is not in the keystore or "trusted". Now if you have your own testing site and did a self-signed like above, then sure you just want to trust it temporary and simply want to fetch the data. However configuring the Java API to do such simple task is a nightmare.</p>
<p>Today, I found a library that allow you to perform exactly this: <a href="https://github.com/kevinsawicki/http-request">https://github.com/kevinsawicki/http-request</a> Trying this out using Groovy is pretty sweet:</p>
<div class="highlight"><pre><span></span><code>    <span class="nd">@Grab</span><span class="p">(</span><span class="s1">&#39;com.github.kevinsawicki:http-request:3.1&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">com.github.kevinsawicki.http.</span><span class="o">*</span>
    <span class="k">def</span> <span class="nf">req</span> <span class="o">=</span> <span class="n">HttpRequest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://www.pcwebshop.co.uk&quot;</span><span class="p">)</span>
    <span class="n">req</span><span class="o">.</span><span class="n">trustAllCerts</span><span class="p">()</span>
    <span class="n">req</span><span class="o">.</span><span class="n">trustAllHosts</span><span class="p">()</span>
    <span class="n">println</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">body</span><span class="p">())</span>
</code></pre></div>

<p>And Voila! We read the URL context without the pesky exception. This <code>http-request</code> is awesome! Now I wish JDK let you do simple thing like this. This is extremely useful for testing.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>