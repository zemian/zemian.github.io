<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Taming the JMX on WebLogic Server</title>
        <link rel="stylesheet" href="https://zemian.github.io/theme/css/main.css" />
        <link href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ZBlog Atom Feed" />
        <meta name="description" content="Taming the JMX on WebLogic Server Taming the JMX on WebLogic Server Let assume couple things first: 1) I assume you have heard of Javaâ€™s JMX..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://zemian.github.io/">ZBlog</a></h1>
                <nav><ul>
                    <li><a href="https://zemian.github.io/pages/about-the-author.html">About The Author</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://zemian.github.io/2013/taming-the-jmx-on-weblogic-server.html" rel="bookmark"
           title="Permalink to Taming the JMX on WebLogic Server">Taming the JMX on WebLogic Server</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-06-11T00:00:00-05:00">
                Published: Tue 11 June 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://zemian.github.io/author/zemian-deng.html">Zemian Deng</a>
        </address>
<p>In <a href="https://zemian.github.io/category/blog.html">Blog</a>.</p>
<p>tags: <a href="https://zemian.github.io/tag/weblogic.html">weblogic</a> <a href="https://zemian.github.io/tag/jmx.html">jmx</a> </p>
</footer><!-- /.post-info -->      <p>Taming the JMX on WebLogic Server</p>
<h1>Taming the JMX on WebLogic Server</h1>
<p>Let assume couple things first:</p>
<p>1) I assume you have heard of Java&#8217;s JMX features and familiar what it does (expose and manage your service remotely). You ought to know that default JVM will have a Platform MBeanServer instance that you can register MBean. And you may view them using the <code>jconsole</code> command from the JDK.</p>
<p>2) As of today, I think by far the easiest way you can expose any services in your application to a JMX MBeanServer is using Spring&#8217;s exporter. You will do something like this:</p>
<div class="highlight"><pre><span></span><code>        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;assembler&quot;</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.jmx.export.assembler.InterfaceBasedMBeanInfoAssembler&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;managedInterfaces&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;list&gt;</span>
                            <span class="cm">&lt;!-- Expose any java interface you like to see under JMX as MBean --&gt;</span>
                            <span class="nt">&lt;value&gt;</span>myproject.services.Service<span class="nt">&lt;/value&gt;</span>
                        <span class="nt">&lt;/list&gt;</span>
                    <span class="nt">&lt;/property&gt;</span>
                  <span class="nt">&lt;/bean&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;beans&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;myproject.services:name=MyCoolService&quot;</span> <span class="na">value-ref=</span><span class="s">&quot;myCoolService&quot;</span><span class="nt">/&gt;</span>
              <span class="nt">&lt;/map&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
        <span class="cm">&lt;!-- This service must implements the interface used above --&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myCoolService&quot;</span> <span class="na">class=</span><span class="s">&quot;myproject.services.MyCoolService&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
</code></pre></div>

<p>Above should get you standalone application with JMX enabled.</p>
<p>Now if you want to do similar on WebLogic Server, then I have few goodies and notes that might help you. Read on&#8230;</p>
<h2>WebLogic Server&#8217;s (WLS) MBeanServer</h2>
<h3>The JConsole trick</h3>
<p>The WLS, like many other EE server will have it&#8217;s own MBeanServer. However, to see the MBean&#8217;s you would need to do little extra with <code>jconsole</code>. Assume you have a default config WLS started on localhost, then you can connect to it like this.</p>
<div class="highlight"><pre><span></span><code>jconsole -J-Djava.class.path=&quot;$JAVA_HOME/lib/jconsole.jar:$MW_HOME/wlserver/server/lib/wljmxclient.jar&quot; -J-Djmx.remote.protocol.provider.pkgs=weblogic.management.remote
</code></pre></div>

<p>Then when prompted to login, enter the following:</p>
<div class="highlight"><pre><span></span><code>Remote Process: service:jmx:iiop://localhost:7001/jndi/weblogic.management.mbeanservers.runtime
User: &lt;same userid you used setup WLS to their console app.&gt;
Password: &lt;same password you used setup WLS to their console app.&gt;
</code></pre></div>

<p>Now you should see all the MBeans that WLS already exposed to you as a EE server. You may add your own service there.</p>
<h3>Programming with JMX connection</h3>
<p>You may connect to the WLS MBeanServer remotely inside your standalone application. Here is a typical connection code you would need</p>
<div class="highlight"><pre><span></span><code><span class="w">            </span><span class="nt">String</span><span class="w"> </span><span class="nt">serviceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;com.bea:Name=DomainRuntimeService,Type=weblogic.management.mbeanservers.domainruntime.DomainRuntimeServiceMBean&quot;</span><span class="o">;</span><span class="w"></span>
<span class="w">            </span><span class="nt">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="err">ObjectName</span><span class="w"> </span><span class="err">service</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">ObjectName(serviceName)</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="nt">catch</span><span class="w"> </span><span class="o">(</span><span class="nt">MalformedObjectNameException</span><span class="w"> </span><span class="nt">e</span><span class="o">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="err">throw</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">RuntimeException(&quot;Not</span><span class="w"> </span><span class="err">able</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">create</span><span class="w"> </span><span class="err">JMX</span><span class="w"> </span><span class="n">ObjectName</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot; + serviceName);</span>
<span class="s2">            }</span>

<span class="s2">            String protocol = &quot;</span><span class="n">t3</span><span class="s2">&quot;;</span>
<span class="s2">            String jndiroot = &quot;</span><span class="o">/</span><span class="n">jndi</span><span class="o">/</span><span class="s2">&quot;;</span>
<span class="s2">            String mserver = &quot;</span><span class="n">weblogic</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">mbeanservers</span><span class="o">.</span><span class="n">runtime</span><span class="s2">&quot;;</span>
<span class="s2">            try {</span>
<span class="s2">                JMXServiceURL serviceURL = new JMXServiceURL(protocol, &quot;</span><span class="n">localhost</span><span class="s2">&quot;, 7001, jndiroot + mserver);</span>

<span class="s2">                Hashtable h = new Hashtable();</span>
<span class="s2">                h.put(Context.SECURITY_PRINCIPAL, username);</span>
<span class="s2">                h.put(Context.SECURITY_CREDENTIALS, password);</span>
<span class="s2">                h.put(JMXConnectorFactory.PROTOCOL_PROVIDER_PACKAGES,</span>
<span class="s2">                        &quot;</span><span class="n">weblogic</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">remote</span><span class="s2">&quot;);</span>
<span class="s2">                h.put(&quot;</span><span class="n">jmx</span><span class="o">.</span><span class="n">remote</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">waiting</span><span class="o">.</span><span class="n">timeout</span><span class="s2">&quot;, new Long(10000));</span>
<span class="s2">                JMXConnector connector = JMXConnectorFactory.connect(serviceURL, h);</span>
<span class="s2">                MBeanServerConnection remoteMBeanServer = connector.getMBeanServerConnection();</span>

<span class="s2">                // TODO: Do what you need with remoteMBeanServer here.</span>
<span class="s2">            } catch (Exception e) {</span>
<span class="s2">                throw new RuntimeException(&quot;</span><span class="n">Not</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="kc">to</span><span class="w"> </span><span class="n">initiate</span><span class="w"> </span><span class="n">MBeanServer</span><span class="w"> </span><span class="n">protocol</span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; + protocol +</span>
<span class="s2">                        &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">jndiroot</span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; + jndiroot + &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mserver</span><span class="o">=</span><span class="w"> </span><span class="err">&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mserver</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>That's a mouthful of boiler code just to get a remote MBeanServer connection! Fortunately there is another easier way though. Read on&#8230;</p>
<h3>The JNDI trick</h3>
<p>The WLS MBeanServer service is also available through JNDI lookup. Again Spring can help you with their JNDI lookup and you simply need to inject it to other services that need it. For example:</p>
<div class="highlight"><pre><span></span><code>        <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;jmxServerRuntime&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.jndi.JndiObjectFactoryBean&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jndiName&quot;</span> <span class="na">value=</span><span class="s">&quot;java:comp/env/jmx/runtime&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;exporter&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;beans&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;map&gt;</span>
                    <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;myproject.services:name=MyCoolService&quot;</span> <span class="na">value-ref=</span><span class="s">&quot;myCoolService&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/map&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;server&quot;</span> <span class="na">ref=</span><span class="s">&quot;jmxServerRuntime&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
</code></pre></div>

<p>Notice that we have injetcted the "server" property with one we looked up from WLS JNDI service. If you use that in your WAR application and deploy it onto a WLS instance, and whola, you got yourself exposed service onto WLS JMX!</p>
<p>Note</p>
<p>above will only works if your Spring xml config is part of the WAR/JAR/EAR that&#8217;s deployed in same server where JNDI lives! If you are not, you need to use this JNDI name without the "env" part instead, like "java:comp/env/jmx/runtime".</p>
<p>For more details on how to work with JMX and WLS, see their docs here:
<a href="http://docs.oracle.com/cd/E12839_01/web.1111/e13728/accesswls.htm#i1119556">http://docs.oracle.com/cd/E12839_01/web.1111/e13728/accesswls.htm#i1119556</a></p>
<p>Last updated 2013-06-12 23:52:42 EDT</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>