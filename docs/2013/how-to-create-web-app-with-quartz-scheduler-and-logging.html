<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>How to create web-app with Quartz Scheduler and logging</title>
        <link rel="stylesheet" href="https://zemian.github.io/theme/css/main.css" />
        <link href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ZBlog Atom Feed" />
        <meta name="description" content="I sometimes help out users in Quartz Scheduler forums. Once in a while some one would ask how can he/she setup the Quartz inside a web..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://zemian.github.io/">ZBlog</a></h1>
                <nav><ul>
                    <li><a href="https://zemian.github.io/pages/about-the-author.html">About The Author</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://zemian.github.io/2013/how-to-create-web-app-with-quartz-scheduler-and-logging.html" rel="bookmark"
           title="Permalink to How to create web-app with Quartz Scheduler and logging">How to create web-app with Quartz Scheduler and logging</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-08-25T00:00:00-05:00">
                Published: Sun 25 August 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://zemian.github.io/author/zemian-deng.html">Zemian Deng</a>
        </address>
<p>In <a href="https://zemian.github.io/category/blog.html">Blog</a>.</p>
<p>tags: <a href="https://zemian.github.io/tag/quartz.html">quartz</a> </p>
</footer><!-- /.post-info -->      <p>I sometimes help out users in Quartz Scheduler forums. Once in a while some one would
ask how can he/she setup the Quartz inside a web application. This is actualy a fairly
simple thing to do. The library already comes with a <code>ServletContextListener</code> that
you can use to start a Scheduler. I will show you a simple webapp example here.</p>
<p>First create a Maven <code>pom.xml</code> file.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span>
        <span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>quartz-web-demo<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>quartz-web-demo<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0-SANPSHOT<span class="nt">&lt;/version&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.quartz-scheduler<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>quartz<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.2.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div>

<p>Then you need to create a <code>src/main/webapp/META-INF/web.xml</code> file.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
 <span class="nt">&lt;web-app</span> <span class="na">version=</span><span class="s">&quot;2.5&quot;</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span>
        <span class="s">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span><span class="nt">&gt;</span>

     <span class="nt">&lt;context-param&gt;</span>
         <span class="nt">&lt;param-name&gt;</span>quartz:config-file<span class="nt">&lt;/param-name&gt;</span>
         <span class="nt">&lt;param-value&gt;</span>quartz.properties<span class="nt">&lt;/param-value&gt;</span>
     <span class="nt">&lt;/context-param&gt;</span>
     <span class="nt">&lt;context-param&gt;</span>
         <span class="nt">&lt;param-name&gt;</span>quartz:shutdown-on-unload<span class="nt">&lt;/param-name&gt;</span>
         <span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
     <span class="nt">&lt;/context-param&gt;</span>
     <span class="nt">&lt;context-param&gt;</span>
         <span class="nt">&lt;param-name&gt;</span>quartz:wait-on-shutdown<span class="nt">&lt;/param-name&gt;</span>
         <span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
     <span class="nt">&lt;/context-param&gt;</span>
     <span class="nt">&lt;context-param&gt;</span>
         <span class="nt">&lt;param-name&gt;</span>quartz:start-on-load<span class="nt">&lt;/param-name&gt;</span>
         <span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
     <span class="nt">&lt;/context-param&gt;</span>

     <span class="nt">&lt;listener&gt;</span>
         <span class="nt">&lt;listener-class&gt;</span>org.quartz.ee.servlet.QuartzInitializerListener<span class="nt">&lt;/listener-class&gt;</span>
     <span class="nt">&lt;/listener&gt;</span>

 <span class="nt">&lt;/web-app&gt;</span>
</code></pre></div>

<p>And lastly, you need a <code>src/main/resources/quartz.properties</code> config file for Scheduler.</p>
<div class="highlight"><pre><span></span><code># Main Quartz configuration
org.quartz.scheduler.skipUpdateCheck = true
org.quartz.scheduler.instanceName = MyQuartzScheduler
org.quartz.scheduler.jobFactory.class = org.quartz.simpl.SimpleJobFactory
org.quartz.threadPool.class = org.quartz.simpl.SimpleThreadPool
org.quartz.threadPool.threadCount = 5
</code></pre></div>

<p>You may configure
<a href="http://quartz-scheduler.org/documentation/quartz-2.2.x/configuration/">many other things</a> with Quartz,
but above should get you started as in In-Memory scheduler.</p>
<p>Now you should able to compile and run it.</p>
<div class="highlight"><pre><span></span><code>bash&gt; mvn compile
bash&gt; mvn org.apache.tomcat.maven:tomcat7-maven-plugin:2.1:run -Dmaven.tomcat.port=8081
</code></pre></div>

<h2>How to configure logging for Quartz Scheduler</h2>
<p>Another frequently asked question is how do they setup logging and see the DEBUG level
messages. The Quartz Schedulers uses SLF4J, so you have many
<a href="https://zemian.github.io/2013/08/how-to-configure-slf4j-with-different.html">loggers options</a>
to choose. I will show you how to setup Log4j for example below.</p>
<p>First, add this to your <code>pom.xml</code></p>
<div class="highlight"><pre><span></span><code>        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.7.5<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>

<p>Then add <code>src/main/resources/log4j.properties</code> file to show messages onto STDOUT.</p>
<div class="highlight"><pre><span></span><code>log4j.rootLogger=INFO, stdout
log4j.logger.org.quartz=DEBUG
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%5p [%t] (%F:%L) - %m%n
</code></pre></div>

<p>Restart your web application on command line, and now you should see all the DEBUG
level logging messages coming from Quartz library.</p>
<p>With everything running, your next question might be asking how do you access the scheduler
from your web application? Well, when the scheduler is created by the servlet context listener,
it is stored inside the web app&#8217;s ServletContext space with
<code>org.quartz.impl.StdSchedulerFactory.KEY</code> key. So you may retrieve it and use it in your
own Servlet like this:</p>
<div class="highlight"><pre><span></span><code><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">YourServlet</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">HttpServlet</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">init</span><span class="p">(</span><span class="n">ServletConfig</span><span class="w"> </span><span class="n">cfg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;org.quartz.impl.StdSchedulerFactory.KEY&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ServletContext</span><span class="w"> </span><span class="n">servletContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cfg</span><span class="o">.</span><span class="n">getServletContext</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">StdSchedulerFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">StdSchedulerFactory</span><span class="p">)</span><span class="w"> </span><span class="n">servletContext</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Scheduler</span><span class="w"> </span><span class="n">quartzScheduler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="o">.</span><span class="n">getScheduler</span><span class="p">(</span><span class="s2">&quot;MyQuartzScheduler&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">TODO</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">quartzScheduler</span><span class="w"> </span><span class="n">here</span><span class="o">.</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Now you are on your way to build your next scheduling application!</p>
<p>Have fun!</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>