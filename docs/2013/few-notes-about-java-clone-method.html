<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Few notes about Java clone() method</title>
        <link rel="stylesheet" href="https://zemian.github.io/theme/css/main.css" />
        <link href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ZBlog Atom Feed" />
        <meta name="description" content="Did you know you can create new Java instance without constructor? That's right, and this feature is brought to you by the Java clone() method. I..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://zemian.github.io/">ZBlog</a></h1>
                <nav><ul>
                    <li><a href="https://zemian.github.io/pages/about-the-author.html">About The Author</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://zemian.github.io/2013/few-notes-about-java-clone-method.html" rel="bookmark"
           title="Permalink to Few notes about Java clone() method">Few notes about Java clone() method</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-02-20T00:00:00-05:00">
                Published: Wed 20 February 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://zemian.github.io/author/zemian-deng.html">Zemian Deng</a>
        </address>
<p>In <a href="https://zemian.github.io/category/blog.html">Blog</a>.</p>
<p>tags: <a href="https://zemian.github.io/tag/java.html">java</a> </p>
</footer><!-- /.post-info -->      <p>Did you know you can create new Java instance without constructor? That's right, and this feature is brought to you by the Java clone() method. I personally don't like to use it much because it has many pitfalls, and it feels very broken in many ways. You probably can write better "clone" by using copy constructor or a static copy factory methods.</p>
<p>Anyrate, here is a unit test that highlights few notes I have gathered about Java clone. Look for the "Note" comments below.</p>
<div class="highlight"><pre><span></span><code>    <span class="n">package</span> <span class="n">atest</span><span class="p">;</span>

    <span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="p">;</span>

    <span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
    <span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">hamcrest</span><span class="o">.</span><span class="n">Matchers</span><span class="o">.</span><span class="n">hasItems</span><span class="p">;</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">hamcrest</span><span class="o">.</span><span class="n">Matchers</span><span class="o">.</span><span class="ow">is</span><span class="p">;</span>
    <span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">junit</span><span class="o">.</span><span class="n">Assert</span><span class="o">.</span><span class="n">assertThat</span><span class="p">;</span>

    <span class="n">public</span> <span class="k">class</span> <span class="nc">CloneTest</span> <span class="p">{</span>
        <span class="nd">@Test</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">testFooClone</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">{</span>
            <span class="n">Foo</span> <span class="n">a</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Foo</span><span class="p">();</span>
            <span class="n">Foo</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">clone</span><span class="p">();</span>

            <span class="n">assertThat</span><span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="n">true</span><span class="p">));</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">constructorCallsCount</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">));</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">constructorCallsCount</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span> <span class="o">//</span> <span class="n">Note1</span><span class="p">:</span> <span class="n">Wow</span><span class="p">,</span> <span class="n">a</span> <span class="n">new</span> <span class="n">instance</span> <span class="n">without</span> <span class="n">calling</span> <span class="n">constructor</span><span class="err">!</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">));</span>

            <span class="n">a</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;fooX&quot;</span><span class="p">;</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="s2">&quot;fooX&quot;</span><span class="p">));</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">));</span>

            <span class="n">Foo2</span> <span class="n">c</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Foo2</span><span class="p">();</span>
            <span class="n">c</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">);</span>
            <span class="n">Foo2</span> <span class="n">d</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">clone</span><span class="p">();</span>
            <span class="n">d</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">);</span>

            <span class="n">c</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">clear</span><span class="p">();</span>
            <span class="n">c</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">);</span>

            <span class="n">assertThat</span><span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="n">d</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="n">true</span><span class="p">));</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">constructorCallsCount</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">));</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">constructorCallsCount</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="ow">is</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">));</span>

            <span class="n">assertThat</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">hasItems</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">));</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="ow">is</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">hasItems</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">));</span>
            <span class="n">assertThat</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="ow">is</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="o">/**</span> <span class="n">A</span> <span class="n">simple</span> <span class="n">clone</span> <span class="n">examples</span> <span class="k">with</span> <span class="n">simple</span> <span class="nb">type</span> <span class="n">fields</span><span class="o">.</span> <span class="o">*/</span>
        <span class="n">public</span> <span class="n">static</span> <span class="k">class</span> <span class="nc">Foo</span> <span class="n">implements</span> <span class="n">Cloneable</span> <span class="p">{</span>
            <span class="n">static</span> <span class="nb">int</span> <span class="n">constructorCallsCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span><span class="p">;</span>
            <span class="n">public</span> <span class="n">Foo</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">constructorCallsCount</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">public</span> <span class="n">Foo</span> <span class="n">clone</span><span class="p">()</span> <span class="p">{</span>
                <span class="o">//</span> <span class="n">Note2</span><span class="p">:</span> <span class="n">Catch</span> <span class="n">checked</span> <span class="n">exception</span> <span class="n">here</span> <span class="n">so</span> <span class="n">client</span> <span class="ow">or</span> <span class="n">subclass</span> <span class="n">doesn</span><span class="s1">&#39;t need to.</span>
                <span class="n">Foo</span> <span class="n">result</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">Foo</span><span class="p">)</span><span class="nb">super</span><span class="o">.</span><span class="n">clone</span><span class="p">();</span>
                <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">CloneNotSupportedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">throw</span> <span class="n">new</span> <span class="n">RuntimeException</span><span class="p">(</span><span class="s2">&quot;Unable to clone.&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="o">/**</span> <span class="n">A</span> <span class="n">clone</span> <span class="n">example</span> <span class="n">that</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">fix</span> <span class="n">field</span> <span class="n">afterward</span> <span class="nb">super</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span> <span class="o">*/</span>
        <span class="n">public</span> <span class="n">static</span> <span class="k">class</span> <span class="nc">Foo2</span> <span class="n">extends</span> <span class="n">Foo</span> <span class="p">{</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">ids</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="p">();</span>
            <span class="n">public</span> <span class="n">Foo2</span> <span class="n">clone</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">Foo2</span> <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">Foo2</span><span class="p">)</span><span class="nb">super</span><span class="o">.</span><span class="n">clone</span><span class="p">();</span> <span class="o">//</span> <span class="n">Note3</span><span class="p">:</span> <span class="n">Some</span> <span class="n">how</span><span class="p">,</span> <span class="nb">super</span> <span class="n">clone</span> <span class="n">will</span> <span class="n">auto</span> <span class="k">return</span> <span class="n">the</span> <span class="n">correct</span> <span class="nb">type</span><span class="err">!</span>
                <span class="n">result</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="p">(</span><span class="n">ids</span><span class="p">);</span>   <span class="o">//</span> <span class="n">Note4</span><span class="p">:</span> <span class="n">need</span> <span class="n">to</span> <span class="n">fix</span> <span class="n">non</span><span class="o">-</span><span class="n">simple</span> <span class="n">field</span><span class="o">.</span>
                <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>