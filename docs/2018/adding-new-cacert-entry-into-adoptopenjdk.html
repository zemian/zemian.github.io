<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Adding new cacert entry into AdoptOpenJDK</title>
        <link rel="stylesheet" href="https://zemian.github.io/theme/css/main.css" />
        <link href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ZBlog Atom Feed" />
        <meta name="description" content="I downloaded latest Tomcat source and it failed to get the dependencies. cd src/github/tomcat ant download-test-compile [get] Error getting..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://zemian.github.io/">ZBlog</a></h1>
                <nav><ul>
                    <li><a href="https://zemian.github.io/pages/about-the-author.html">About The Author</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://zemian.github.io/2018/adding-new-cacert-entry-into-adoptopenjdk.html" rel="bookmark"
           title="Permalink to Adding new cacert entry into AdoptOpenJDK">Adding new cacert entry into AdoptOpenJDK</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-07-23T00:00:00-05:00">
                Published: Mon 23 July 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://zemian.github.io/author/zemian-deng.html">Zemian Deng</a>
        </address>
<p>In <a href="https://zemian.github.io/category/blog.html">Blog</a>.</p>
<p>tags: <a href="https://zemian.github.io/tag/cacert.html">cacert</a> <a href="https://zemian.github.io/tag/keytool.html">keytool</a> <a href="https://zemian.github.io/tag/openjdk.html">openjdk</a> <a href="https://zemian.github.io/tag/jdk.html">jdk</a> <a href="https://zemian.github.io/tag/java.html">java</a> </p>
</footer><!-- /.post-info -->      <p>I downloaded latest Tomcat source and it failed to get the dependencies.</p>
<div class="highlight"><pre><span></span><code><span class="w">      </span><span class="n">cd</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">github</span><span class="o">/</span><span class="n">tomcat</span><span class="w"></span>
<span class="w">      </span><span class="n">ant</span><span class="w"> </span><span class="n">download</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">compile</span><span class="w"></span>
<span class="w">            </span><span class="o">[</span><span class="n">get</span><span class="o">]</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">getting</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">repo</span><span class="p">.</span><span class="n">maven</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">maven2</span><span class="o">/</span><span class="n">junit</span><span class="o">/</span><span class="n">junit</span><span class="o">/</span><span class="mf">4.12</span><span class="o">/</span><span class="n">junit</span><span class="o">-</span><span class="mf">4.12</span><span class="p">.</span><span class="n">jar</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">zemian</span><span class="err">\</span><span class="n">tomcat</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">libs</span><span class="err">\</span><span class="n">download</span><span class="o">-</span><span class="mf">2000731528.</span><span class="n">tmp</span><span class="w"></span>

<span class="w">    </span><span class="n">BUILD</span><span class="w"> </span><span class="n">FAILED</span><span class="w"></span>
<span class="w">    </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">zemian</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">github</span><span class="err">\</span><span class="n">tomcat</span><span class="err">\</span><span class="n">build</span><span class="p">.</span><span class="nc">xml</span><span class="err">:</span><span class="mi">2705</span><span class="err">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurred</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="nl">line</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">zemian</span><span class="err">\</span><span class="n">src</span><span class="err">\</span><span class="n">github</span><span class="err">\</span><span class="n">tomcat</span><span class="err">\</span><span class="n">build</span><span class="p">.</span><span class="nc">xml</span><span class="err">:</span><span class="mi">3051</span><span class="err">:</span><span class="w"> </span><span class="n">javax</span><span class="p">.</span><span class="n">net</span><span class="p">.</span><span class="n">ssl</span><span class="p">.</span><span class="nl">SSLException</span><span class="p">:</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="nl">RuntimeException</span><span class="p">:</span><span class="w"> </span><span class="n">Unexpected</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="n">security</span><span class="p">.</span><span class="nl">InvalidAlgorithmParameterException</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">trustAnchors</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">empty</span><span class="w"></span>
<span class="w">            </span><span class="k">at</span><span class="w"> </span><span class="n">sun</span><span class="p">.</span><span class="n">security</span><span class="p">.</span><span class="n">ssl</span><span class="p">.</span><span class="n">Alerts</span><span class="p">.</span><span class="n">getSSLException</span><span class="p">(</span><span class="n">Alerts</span><span class="p">.</span><span class="nl">java</span><span class="p">:</span><span class="mi">208</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p>It turns out this error is caused by the OpenJDK 8 that I am using. The
one I got is from <a href="https://adoptopenjdk.net/">https://adoptopenjdk.net/</a>, and the
<code>$JAVA_HOME/jre/lib/security/cacert</code> file has no entries for trusted CA
certs!</p>
<p>So I found few solutions:</p>
<ol>
<li>
<p>Find a copy of OracleJDK and copy their <code>cacerts</code> over.</p>
</li>
<li>
<p>If you are on Linux, you can try installing cacerts using tools the
    OS provided. (eg: Ubuntu can be done like here:
    <a href="https://stackoverflow.com/questions/6784463/error-trustanchors-parameter-must-be-non-empty">https://stackoverflow.com/questions/6784463/error-trustanchors-parameter-must-be-non-empty</a>)</p>
</li>
<li>
<p>Upgrade OpenJDK to 10</p>
</li>
<li>
<p>Or the quick way, go to the site that gives you problem, export
    their cert using the browser, and then import into to the <code>cacerts</code>
    file.</p>
</li>
</ol>
<p>So for me, I went to <a href="https://repo.maven.apache.org/">https://repo.maven.apache.org/</a> and exported
<code>repomavenapacheorg.crt</code>, and then I ran the following:</p>
<div class="highlight"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="o">$</span><span class="n">JAVA_HOME</span><span class="o">/</span><span class="n">jre</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">security</span><span class="w"></span>
<span class="n">keytool</span><span class="w"> </span><span class="o">-</span><span class="n">keystore</span><span class="w"> </span><span class="n">cacerts</span><span class="w"> </span><span class="o">-</span><span class="n">storepasswd</span><span class="w"> </span><span class="n">changeit</span><span class="w"> </span><span class="o">-</span><span class="n">importcert</span><span class="w"> </span><span class="o">-</span><span class="n">file</span><span class="w"> </span><span class="s1">&#39;Downloads/repomavenapacheorg.crt&#39;</span><span class="w"> </span><span class="o">-</span><span class="n">trustcacerts</span><span class="w"></span>
<span class="n">keytool</span><span class="w"> </span><span class="o">-</span><span class="n">keystore</span><span class="w"> </span><span class="n">cacerts</span><span class="w"> </span><span class="o">-</span><span class="n">storepasswd</span><span class="w"> </span><span class="n">changeit</span><span class="w"> </span><span class="o">-</span><span class="n">list</span><span class="w"></span>
</code></pre></div>

<p>This fixed my problem.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>