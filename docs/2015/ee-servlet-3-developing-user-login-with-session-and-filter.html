<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>EE Servlet 3 - Developing User Login with Session and Filter</title>
        <link rel="stylesheet" href="https://zemian.github.io/theme/css/main.css" />
        <link href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ZBlog Atom Feed" />
        <meta name="description" content="I have introduced the Application class in my previous post where you can setup backend services. One example service I added is the UserService...." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://zemian.github.io/">ZBlog</a></h1>
                <nav><ul>
                    <li><a href="https://zemian.github.io/pages/about-the-author.html">About The Author</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://zemian.github.io/2015/ee-servlet-3-developing-user-login-with-session-and-filter.html" rel="bookmark"
           title="Permalink to EE Servlet 3 - Developing User Login with Session and Filter">EE Servlet 3 - Developing User Login with Session and Filter</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-01-16T00:00:00-05:00">
                Published: Fri 16 January 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://zemian.github.io/author/zemian-deng.html">Zemian Deng</a>
        </address>
<p>In <a href="https://zemian.github.io/category/blog.html">Blog</a>.</p>
<p>tags: <a href="https://zemian.github.io/tag/servlet.html">servlet</a> </p>
</footer><!-- /.post-info -->      <p>I have introduced the Application class in my previous post where you can setup backend services. One example service I added is the UserService. This service will load a Java users properties file that contains username and password sets; and it's used later to authenticate users to login into the web application. Now I will show how the login part is done using standard Servlet API along with this backend service.</p>
<p>At a high level, what we want is to restrict some web resources (this means certain URLs provided by Servlets such as "/sysprops", or "/user") to only client users who are known in our users properties file. Users may identify themself with the matching password. This is typically done with a user login form, authenticate it, then insert a login token into Http Session scope space. This login token then can be used to verify whether to allow users to access the restricted resources or not. We only interested in a single authorization (no roles are defined, and any logged in user may access any protected URLs.)</p>
<p>You have already seen an example that mapped to "/sysprops" URL in one of my previous post provided by the SysPropsServlet, which it simply generate a HTML table of System information. These are sensitive information, so we want to protect this URL. We would need to create a class that implements javax.servlet.Filter interface, and then add the "/sysprops" URL with this filter so it can pre-process the request before the actual Servlet does. This filter gives us a place to inspect the HTTP request object and abort the request if needed to, thus restricting the access.</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">zemian</span><span class="o">.</span><span class="n">servlet3example</span><span class="o">.</span><span class="n">web</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.Filter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterChain</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterConfig</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletResponse</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.annotation.WebFilter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">zemian.service.logging.Logger</span><span class="p">;</span>

<span class="nd">@WebFilter</span><span class="p">(</span><span class="n">urlPatterns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;/sys-props&quot;</span><span class="p">,</span> <span class="s2">&quot;/user&quot;</span><span class="p">})</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">LoginRequiredFilter</span> <span class="n">implements</span> <span class="n">Filter</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">static</span> <span class="n">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Logger</span><span class="p">(</span><span class="n">LoginRequiredFilter</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>
    <span class="n">public</span> <span class="n">static</span> <span class="n">final</span> <span class="n">String</span> <span class="n">LOGIN_REDIRECT</span> <span class="o">=</span> <span class="s2">&quot;LOGIN_REDIRECT&quot;</span><span class="p">;</span>

    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">init</span><span class="p">(</span><span class="n">FilterConfig</span> <span class="n">filterConfig</span><span class="p">)</span> <span class="n">throws</span> <span class="n">ServletException</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">doFilter</span><span class="p">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">ServletResponse</span> <span class="n">response</span><span class="p">,</span> <span class="n">FilterChain</span> <span class="n">chain</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">ServletException</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">request</span> <span class="n">instanceof</span> <span class="n">HttpServletRequest</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">HttpServletRequest</span> <span class="n">req</span> <span class="o">=</span> <span class="p">(</span><span class="n">HttpServletRequest</span><span class="p">)</span> <span class="n">request</span><span class="p">;</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;Checking LoginSession token for uri=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">getRequestURI</span><span class="p">());</span>
            <span class="n">LoginSession</span> <span class="n">loginSession</span> <span class="o">=</span> <span class="n">LoginServlet</span><span class="o">.</span><span class="n">getOptionalLoginSession</span><span class="p">(</span><span class="n">req</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">loginSession</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No LoginSession token found; forwarding request to login page.&quot;</span><span class="p">);</span>
                <span class="o">//</span> <span class="n">We</span> <span class="n">need</span> <span class="n">to</span> <span class="n">save</span> <span class="n">the</span> <span class="n">old</span> <span class="n">URI</span> <span class="n">so</span> <span class="n">we</span> <span class="n">can</span> <span class="n">auto</span> <span class="n">redirect</span> <span class="n">after</span> <span class="n">login</span><span class="o">.</span>
                <span class="n">req</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">LOGIN_REDIRECT</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">getRequestURI</span><span class="p">());</span>
                <span class="n">req</span><span class="o">.</span><span class="n">getRequestDispatcher</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Request allowed using LoginSession token=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">loginSession</span><span class="o">.</span><span class="n">getId</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">destroy</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<p>Notice that you can configure this filter to match more than one URL that you want to protect. You can even use wildcard pattern such as "/*" and it will protect every URLs in your application! The filter simply looks into the Http Session space for a LoginSession object that we will create later. If it's found then it let the request through, otherwise it will redirect to a Login form page, which is served by LoginServlet class (notice the RETURN statement for early exit of the filter method without calling the filter chain!).</p>
<p>The LoginServlet class is a form processing Servlet that will prompt user for username and password. If it succeed, then we will insert the LoginSession token object into the HttpSession space space, which is what the filter above is looking for. Here is the processing Servlet code.</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">zemian</span><span class="o">.</span><span class="n">servlet3example</span><span class="o">.</span><span class="n">web</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.annotation.WebServlet</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">zemian.service.logging.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">zemian.servlet3example.service.Application</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">zemian.servlet3example.service.UserService</span><span class="p">;</span>

<span class="nd">@WebServlet</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">)</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">LoginServlet</span>  <span class="n">extends</span> <span class="n">HtmlWriterServlet</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">static</span> <span class="n">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Logger</span><span class="p">(</span><span class="n">LoginServlet</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>

    <span class="nd">@Override</span>
    <span class="n">protected</span> <span class="n">void</span> <span class="n">doGet</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="p">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="p">)</span> <span class="n">throws</span> <span class="n">ServletException</span><span class="p">,</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">HtmlWriter</span> <span class="n">html</span> <span class="o">=</span> <span class="n">createHtmlWriter</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span> 
        <span class="n">String</span> <span class="n">message</span><span class="p">;</span>

        <span class="o">//</span> <span class="n">Check</span> <span class="n">to</span> <span class="n">see</span> <span class="k">if</span> <span class="n">we</span> <span class="n">are</span> <span class="n">doing</span> <span class="n">logout</span> <span class="ow">or</span> <span class="ow">not</span><span class="o">.</span>
        <span class="n">LoginSession</span> <span class="n">loginSession</span> <span class="o">=</span> <span class="n">getOptionalLoginSession</span><span class="p">(</span><span class="n">req</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">loginSession</span> <span class="o">!=</span> <span class="n">null</span> <span class="o">&amp;&amp;</span> <span class="n">req</span><span class="o">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s2">&quot;logout&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">logout</span><span class="p">(</span><span class="n">req</span><span class="p">);</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Your have successfully logged out.&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>    
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">req</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">message</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="p">}</span>   

        <span class="o">//</span> <span class="n">Show</span> <span class="n">a</span> <span class="n">login</span> <span class="n">form</span>
        <span class="n">String</span> <span class="n">redirectUri</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="n">req</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="n">LoginRequiredFilter</span><span class="o">.</span><span class="n">LOGIN_REDIRECT</span><span class="p">);</span>
        <span class="n">String</span> <span class="n">redirectHtmlTag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">redirectUri</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">redirectHtmlTag</span> <span class="o">=</span> <span class="s2">&quot;&lt;input type=&#39;hidden&#39; name=&#39;redirectUri&#39; value=&#39;&quot;</span> <span class="o">+</span> <span class="n">redirectUri</span> <span class="o">+</span> <span class="s2">&quot;&#39;/&gt;&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">html</span><span class="o">.</span><span class="n">header</span><span class="p">()</span>
            <span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Please Login&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;&lt;form method=&#39;post&#39; action=&#39;login&#39;&gt;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">redirectHtmlTag</span><span class="p">)</span>
            <span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;&lt;p/&gt;Username: &lt;input type=&#39;text&#39; name=&#39;username&#39;/&gt;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;&lt;p/&gt;Password: &lt;input type=&#39;password&#39; name=&#39;password&#39;/&gt;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;&lt;p/&gt;&lt;input type=&#39;submit&#39; value=&#39;Submit&#39;/&gt;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;&lt;/form&gt;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">footer</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="n">protected</span> <span class="n">void</span> <span class="n">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="p">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="p">)</span> <span class="n">throws</span> <span class="n">ServletException</span><span class="p">,</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Processing login form.&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">login</span><span class="p">(</span><span class="n">req</span><span class="p">))</span> <span class="p">{</span>
            <span class="o">//</span> <span class="n">Login</span> <span class="n">succeed</span><span class="p">,</span> <span class="n">we</span> <span class="n">should</span> <span class="n">auto</span> <span class="n">redirect</span> <span class="n">user</span> <span class="k">if</span> <span class="n">exists</span><span class="o">.</span>
            <span class="n">String</span> <span class="n">redirectUri</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s2">&quot;redirectUri&quot;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">redirectUri</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Redirect after login to: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">redirectUri</span><span class="p">);</span>
                <span class="n">resp</span><span class="o">.</span><span class="n">sendRedirect</span><span class="p">(</span><span class="n">redirectUri</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="o">//</span> <span class="n">Show</span> <span class="n">the</span> <span class="n">form</span> <span class="n">again</span> <span class="ow">in</span> <span class="n">case</span> <span class="n">login</span> <span class="n">failed</span> <span class="ow">or</span> <span class="n">user</span> <span class="n">didn</span><span class="s1">&#39;t provide a redirect</span>
        <span class="n">doGet</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
    <span class="p">}</span>    

    <span class="n">protected</span> <span class="n">LoginSession</span> <span class="n">createLoginSession</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="p">,</span> <span class="n">String</span> <span class="n">username</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">LoginSession</span> <span class="n">result</span> <span class="o">=</span> <span class="n">new</span> <span class="n">LoginSession</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
        <span class="n">req</span><span class="o">.</span><span class="n">getSession</span><span class="p">(</span><span class="n">true</span><span class="p">)</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">LoginSession</span><span class="o">.</span><span class="n">LOGIN_SESSION_KEY</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">protected</span> <span class="n">void</span> <span class="n">removeLoginSession</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">getSession</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">session</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">session</span><span class="o">.</span><span class="n">removeAttribute</span><span class="p">(</span><span class="n">LoginSession</span><span class="o">.</span><span class="n">LOGIN_SESSION_KEY</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">private</span> <span class="n">boolean</span> <span class="n">login</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">);</span>
        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">getParameter</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">);</span>

        <span class="n">UserService</span> <span class="n">userService</span> <span class="o">=</span> <span class="n">Application</span><span class="o">.</span><span class="n">getInstance</span><span class="p">()</span><span class="o">.</span><span class="n">getUserService</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">userService</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;User </span><span class="si">%s</span><span class="s2"> logged in successfully.&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">);</span>
            <span class="o">//</span> <span class="n">Create</span> <span class="n">Session</span> <span class="n">Data</span> <span class="n">here</span> <span class="n">after</span> <span class="n">successful</span> <span class="n">authenticated</span><span class="o">.</span>
            <span class="n">LoginSession</span> <span class="n">loginsession</span> <span class="o">=</span> <span class="n">getOptionalLoginSession</span><span class="p">(</span><span class="n">req</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">loginsession</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">createLoginSession</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">username</span><span class="p">);</span>
                <span class="n">req</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;You have successfully logged in.&quot;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">req</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;You already have logged in.&quot;</span><span class="p">);</span>             
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;User </span><span class="si">%s</span><span class="s2"> failed to login.&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">);</span>
            <span class="n">req</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;Invalid login.&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">/**</span> <span class="n">Return</span> <span class="n">LoginSession</span> <span class="k">if</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">HttpSession</span> <span class="n">scope</span><span class="p">,</span> <span class="k">else</span> <span class="k">return</span> <span class="n">NULL</span> <span class="n">value</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">public</span> <span class="n">static</span> <span class="n">LoginSession</span> <span class="n">getOptionalLoginSession</span><span class="p">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">LoginSession</span> <span class="n">result</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
        <span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">getSession</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">session</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">LoginSession</span><span class="p">)</span><span class="n">session</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="n">LoginSession</span><span class="o">.</span><span class="n">LOGIN_SESSION_KEY</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Inside LoginServlet class is where we use the UserService service to validate username and password. We display the login form with a GET request, and then process the login with a POST action. Once username and password are checked, we create the LoginSession object. This is just a simple POJO to represent a session token; and you can hold any user information you want. I won't list here, but you can browse it on GitHub. Note that you should make it serializable though, because any data stored in HttpSession may be subject to be serialize/deserialize by your application server.</p>
<p>Notice also that I have implemented the Logout functionality into the LoginServlet class
 as well. You simply pass "logout" query parameter, and it will be 
detected and remove the login token from the session. Ensure you invalid
 the HttpSession itself when you do this, just to be in clean side. I 
also exposed a static helper <code>getOptionalLoginSession</code></p>
<p>that is used between few of the classes to check whether user has logged in or not.</p>
<p>These few classes are simple but yet demonstrated the use of Servlet Filter and Servlet on how to manage Session data. This programming pattern allows users to have their own browsing session and privacy through the application.</p>
<p>If you are to run my <a href="https://github.com/saltnlight5/java-ee6-examples/tree/master/servlet3-example">servlet3-example</a>  in a GlassFish server, you may login using any users listed in <a href="https://github.com/saltnlight5/java-ee6-examples/blob/master/servlet3-example/src/main/resources/zemian/servlet3example/service/users.properties">here</a>.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://zemian.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>